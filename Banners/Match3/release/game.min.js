var __extends=(this&&this.__extends)||(function(){var a=Object.setPrototypeOf||({__proto__:[]} instanceof Array&&function(e,c){e.__proto__=c})||function(f,c){for(var e in c){if(c.hasOwnProperty(e)){f[e]=c[e]}}};return function(f,c){a(f,c);function e(){this.constructor=f}f.prototype=c===null?Object.create(c):(e.prototype=c.prototype,new e())}})();var mygame;(function(b){var a=(function(d){__extends(c,d);function c(){return d!==null&&d.apply(this,arguments)||this}c.prototype.preload=function(){this.preloadBarBackground=this.add.image(0,0,"preloaderBarEmpty");this.preloadBar=this.add.image(0,0,"preloaderBar");this.preloadBarBackground.alignIn(this.game.world.bounds,Phaser.CENTER);this.preloadBar.x=Math.floor(this.preloadBarBackground.x);this.preloadBar.y=Math.floor(this.preloadBarBackground.y);this.load.setPreloadSprite(this.preloadBar);var e=window.baseURL;this.game.load.atlas("boom_anim",e+"assets/boom_anim.png",e+"assets/boom_anim.json");this.game.load.atlas("atlas",e+"assets/atlas.png",e+"assets/atlas.json");this.game.load.image("character",e+"assets/"+window.characterName+".png");if(window.lang=="en"){this.game.load.image("play_free",e+"assets/Button_Eng_"+window.buttonPlayColor+".png")}else{if(window.lang=="de"){this.game.load.image("play_free",e+"assets/Button_Ger_"+window.buttonPlayColor+".png")}}this.game.load.bitmapFont("font",e+"assets/font.png",e+"assets/font.fnt");this.game.load.bitmapFont("font2",e+"assets/font2.png",e+"assets/font2.fnt")};c.prototype.create=function(){this.game.state.start("PlayState")};c.prototype.ChangeSize=function(){this.game.scale.setGameSize(window.innerWidth,window.innerHeight);this.preloadBarBackground.width=window.innerWidth;this.preloadBarBackground.scale.x=this.preloadBarBackground.scale.x-0.1;this.preloadBarBackground.scale.y=this.preloadBarBackground.scale.x;this.preloadBar.scale.set(this.preloadBarBackground.scale.x,this.preloadBarBackground.scale.y);if(this.game.scale.width>window.innerWidth){this.game.canvas.style.marginLeft="-"+(this.game.scale.width-window.innerWidth)/2+"px"}this.preloadBarBackground.alignIn(this.game.world.bounds,Phaser.CENTER);this.preloadBar.x=this.preloadBarBackground.x;this.preloadBar.y=this.preloadBarBackground.y};return c}(Phaser.State));b.Preloader=a})(mygame||(mygame={}));var mygame;(function(c){var a="1.0.0";var e=(function(g){__extends(h,g);function h(){var i=g.call(this,true)||this;i._winTweens=[];return i}h.prototype.create=function(){var m=this;c.GameConfig.COUNTERS_PUBLIC=[0,window.firstElement,0,window.secondElement,window.thirdElement,0,100,100];this.game.time.advancedTiming=true;this.game.stage.backgroundColor="#64941A";this._winscreenShowed=false;this.game.physics.startSystem(Phaser.Physics.ARCADE);this.game.stage.smoothed=true;this._canShowEndScreen=false;c.Controller.Instance.width=d().width;c.Controller.Instance.height=d().height;this._container=new c.OSprite(c.Core.centerX+200,0).otherXY(c.Core.centerY,0).end();this.game.world.addChild(this._container);this._bushes=[];this._bushes[0]=this.game.add.sprite(c.Core.width,c.Core.height,"atlas","Back-03");this._bushes[0].anchor.set(1,1);this._bushes[1]=this.game.add.sprite(this._bushes[0].width,this._bushes[0].height,"atlas","Back-03");this._bushes[1].scale.set(-1,-1);this._bushes[3]=this.game.add.sprite(c.Core.width-this._bushes[0].width,this._bushes[0].height,"atlas","Back-03");this._bushes[3].scale.set(1,-1);this._bushes[2]=this.game.add.sprite(this._bushes[0].width,c.Core.height-this._bushes[0].height,"atlas","Back-03");this._bushes[2].scale.set(-1,1);this._bench=this.game.add.sprite(c.Core.width,0,"atlas","Back-04");this._bench.anchor.set(1,0);this.game.world.addChild(this._bench);this._rake=this.game.add.sprite(c.Core.width,c.Core.height,"atlas","Back-05");this._rake.anchor.set(1,1);this.game.world.addChild(this._rake);this._bushes.forEach(function(n){return m.game.world.addChild(n)});this._playFreeBtnOsprite=new c.OSprite(c.Core.centerX+250,0).myBottomOffset(70).myScale(0.65).end();this.game.world.addChild(this._playFreeBtnOsprite);this._playFreeBtnOsprite.otherXY(c.Core.centerY,0).otherBottomOffset(73).otherScale(0.65).end();this._playFree=this.game.add.sprite(0,0,"play_free");this._playFree.scale.set(1.3);this._playFree.anchor.set(0.5,0.5);this._playFree.inputEnabled=true;this._playFree.events.onInputDown.add(function(){window.trackClick()},this);this._playFreeBtnOsprite.addChild(this._playFree);if(!window.collectable){this._playFree.alpha=0;this._playFree.y=300}if(window.collectable){this._gamePanelOsprite=new c.OSprite(0,0).myTopOffset(640).otherXY(c.Core.centerY,0).otherTopOffset(230+400-20).myLeftOffset(300).end();this._panel=new c.Panel(this.game,0,0);if(this.game.device.iPad){this._gamePanelOsprite.myTopOffset(750).end()}this._gamePanelOsprite.addChild(this._panel);this._panel.initFruits()}c.GameConfig.gameArray=c.GameConfig.deepClone(c.GameConfig.gameArrayLandscape);this._logoOsprite=new c.OSprite(900,0).myTopOffset(10).myScale(0.65).otherXY(c.Core.centerY,0).otherTopOffset(10).otherScale(0.6).end();this._logo=this.game.add.sprite(0,0,"atlas","Logo-01");this._logo.anchor.set(0.5,0);this._logoOsprite.addChild(this._logo);if(window.collectable){this._container=new c.OSprite(c.Core.centerX+400-85,c.Core.centerY-70).otherXY(c.Core.centerY+50-2,c.Core.centerX+220).end();this._field=new c.Field(this.game,0,0,this);this._container.addChild(this._field);this._field.destroyCallback=function(n,o){m._panel.updateCounter(n,o)};this._field.finalCallback=this.showWinScreen.bind(this)}else{this._container=new c.OSprite(c.Core.centerX,c.Core.centerY).otherXY(c.Core.centerY,c.Core.centerX-80).end();this._field=new c.Field(this.game,0,0,this);this._container.addChild(this._field);this._field.destroyCallback=function(n,o){n+1};this._container.myScale(1).otherScale(1.15).end()}this._field.firstMatchCallback=function(){m.game.add.tween(m._playFree.scale).to({x:1.45,y:1.45},window.buttonPlaySpeed,Phaser.Easing.Sinusoidal.Out,true,0,-1,true)};this._field.pivot.set(100*c.GameConfig.gameArray[0].length/2,100*c.GameConfig.gameArray[1].length/5);this._fruitFallEmitter=this.game.add.emitter(0,-50,Math.ceil(3600/window.fruitSpawRate));this._fruitFallEmitter.makeParticles("atlas",["F_1","F_2","F_3","F_4","F_5"]);this._fruitFallEmitter.setYSpeed(200*window.fruitSpawSpeed,300*window.fruitSpawSpeed);if(!c.Core.isLandscape){this.onPortret()}if(window.tutorial){this._tutorialOver=this.game.make.sprite(-630,-160,"atlas","bannerMask");this._tutorialOver.scale.set(10);this._tutorialOver.alpha=0.8;this._field.addChild(this._tutorialOver);var l=this.game.add.graphics(0,-128);this._tutorialOver.addChild(l);l.beginFill(0,1);l.drawRect(0,0,256,128);l.endFill();var k=this.game.add.graphics(0,72);this._tutorialOver.addChild(k);k.beginFill(0,1);k.drawRect(0,0,128,128);k.endFill();var j=this.game.add.graphics(-128,0);this._tutorialOver.addChild(j);j.beginFill(0,1);j.drawRect(0,0,128,128);j.endFill();var i=this.game.add.graphics(128,0);this._tutorialOver.addChild(i);i.beginFill(0,1);i.drawRect(0,0,128,128);i.endFill();this._hand=this.game.add.sprite(100*4-20-c.GameConfig.BLOCK_SIZE*2,100*2-60,"atlas","Help-Arrow-01");this._hand.anchor.set(0.5);this._handTween=this.game.add.tween(this._hand).to({y:80},500,Phaser.Easing.Sinusoidal.InOut,true,0,-1,true);this._field.addChild(this._hand);this._tutorialContainer=new c.OSprite(c.Core.centerX,c.Core.centerY).myBottomOffset(0).myLeftOffset(35).otherXY(c.Core.centerY,c.Core.centerX).otherLeftOffset(10).otherBottomOffset(0).otherScale(0.8).end();this.game.world.addChild(this._tutorialContainer);this._charTutorialSprite=this.game.make.sprite(0,0,"character");this._charTutorialSprite.anchor.set(0,1);this._tutorialContainer.addChild(this._charTutorialSprite);this._bubbleTutorialSprite=this.game.make.sprite(window.bubbleX,window.bubbleY,"atlas","tutor_bubble");this._bubbleTutorialSprite.anchor.set(0,0.5);this._charTutorialSprite.addChild(this._bubbleTutorialSprite);this._bubbleTutorialText=this.game.add.bitmapText(this._bubbleTutorialSprite.width/2+10,0,"font2",c.Lang.Instance.TUTORIAL[window.lang],32);this._bubbleTutorialText.anchor.setTo(0.5,0.5);this._bubbleTutorialText.align="center";this._bubbleTutorialText.tint=9067303;this._bubbleTutorialSprite.addChild(this._bubbleTutorialText)}setTimeout(function(){m._field.endGame()},window.endGameTimer);this._timerInstall=0;window.gameStarted;this.game.time.events.loop(Phaser.Timer.SECOND,this.tick,this)};h.prototype.tick=function(){this._timerInstall++;window.playTime=this._timerInstall};h.prototype.getGurrentElementPosition=function(i){return this._panel.getElementPosition(i)};h.prototype.update=function(){if(window.collectable){this._panel.update()}if(this._field){this._field.update()}};h.prototype.destroyTutorial=function(){this._handTween.stop();this._hand.destroy();this._tutorialOver.destroy(true);this._tutorialContainer.destroy(true)};h.prototype.repositionEmitter=function(){var i;if(c.Core.isLandscape){i=c.Core.centerX-20}else{i=c.Core.centerY-20}this._fruitFallEmitter.emitX=this.game.rnd.between(-i,i);this.game.time.events.add(window.fruitSpawRate,this.repositionEmitter.bind(this))};h.prototype.showWinScreen=function(){if(!this._winscreenShowed){this._winscreenShowed=true;this._playFree.visible=false;this._playFree.inputEnabled=false;this._playFreeBtnOsprite.removeChild(this._playFree);this._panelContainer=new c.OSprite(c.Core.centerX,c.Core.centerY).otherXY(c.Core.centerY,c.Core.centerX).end();this.game.stage.addChild(this._panelContainer);this._backOverlay=this.game.add.graphics(0,0);this._panelContainer.addChild(this._backOverlay);this._backOverlay.beginFill(2432282,0.8);this._backOverlay.drawRect(-1024,-1024,2048,2048);this._backOverlay.endFill();this._panelContainer.addChild(this._fruitFallEmitter);if(c.Core.isLandscape){this._fruitFallEmitter.emitY=-c.Core.centerY-50}else{this._fruitFallEmitter.emitY=-c.Core.centerX-50}this._fruitFallEmitter.start(false,3600,window.fruitSpawRate);this.repositionEmitter();this._panelSprite=this.game.make.sprite(-7,0,"atlas","Popup-Back-01");this._panelSprite.anchor.set(0.5);this._panelContainer.addChild(this._panelSprite);this._sunraySprite=this.game.make.sprite(190,0,"atlas","Popup-Back-02");this._sunraySprite.anchor.set(0.5);this._panelSprite.addChild(this._sunraySprite);this.game.add.tween(this._sunraySprite).to({angle:360},18500,Phaser.Easing.Linear.None,true,0,-1);this._panelSprite.addChild(this._playFree);this._playFree.position.set(0,177);this._playFree.anchor.x=0.5;this._playFree.scale.set(0.85,0.85);this._playFree.visible=true;this._playFree.inputEnabled=true;this._congrateText=this.game.add.bitmapText(10,-195,"font2",c.Lang.Instance.CONGRAT[window.lang],42);this._congrateText.anchor.setTo(0.5,0.5);this._congrateText.align="center";this._congrateText.tint=16642539;this._panelSprite.addChild(this._congrateText);this._plotText=this.game.add.bitmapText(190,0,"font2",c.Lang.Instance.PLOT[window.lang],32);this._plotText.anchor.setTo(0.5,0.5);this._plotText.align="center";this._plotText.tint=12090194;this._panelSprite.addChild(this._plotText);this.game.add.tween(this._playFree.scale).to({x:0.9,y:0.9},window.buttonPlaySpeed,Phaser.Easing.Sinusoidal.Out,true,0,-1,true);this._panelContainer.alpha=0;this._panelSprite.scale.set(0.1,0.1);this.game.add.tween(this._panelSprite.scale).to({x:1,y:1},700,Phaser.Easing.Back.Out,true);this.game.add.tween(this._panelContainer).to({alpha:1},700,Phaser.Easing.Sinusoidal.Out,true)}};h.prototype.onLandscape=function(){if(this._rake){this._rake.position.set(c.Core.width-50,c.Core.height);this._rake.angle=0;this.game.world.setChildIndex(this._rake,0);this._bench.position.set(c.Core.width,0);this._bench.scale.set(1,1);this._bushes[2].position.set(this._bushes[0].width,c.Core.height-this._bushes[0].height);this._bushes[1].position.set(this._bushes[0].width,this._bushes[0].height);this._bushes[0].position.set(c.Core.width,c.Core.height);this._bushes[3].alpha=0;this._bushes[0].alpha=1}if(this._panel){this._panel.setLandscape();this._fruitFallEmitter.emitY=-c.Core.centerY-50}};h.prototype.onPortret=function(){if(this._rake){this._rake.position.set(0,1200);this.game.world.setChildIndex(this._rake,this.game.world.children.length-6);this._rake.angle=90;this._bench.position.set(c.Core.width,c.Core.height);this._bench.scale.set(1,-1);this._bushes[2].position.set(this._bushes[0].width,c.Core.height-this._bushes[0].height);this._bushes[1].position.set(this._bushes[0].width,this._bushes[0].height);this._bushes[0].position.set(c.Core.width,c.Core.height);this._bushes[3].alpha=1;this._bushes[0].alpha=0}if(this._panel){this._panel.setPortrait();this._fruitFallEmitter.emitY=-c.Core.centerX-50}};return h}(c.OState));c.PlayState=e;function d(l){if(l===void 0){l=false}var i=0;var k=0;var g=0;var j=0;if(!(document.documentElement.clientWidth==0)){g=document.documentElement.clientWidth;j=document.documentElement.clientHeight}i=g;k=j;if(window.innerWidth>window.innerHeight){i=window.innerWidth;k=window.innerHeight}return{width:i,height:k}}function f(g,h){if(h===void 0){h=null}window.trackEvent(g,h)}function b(){window.trackClick()}})(mygame||(mygame={}));var mygame;(function(a){var b=(function(){function c(){this.balance=500;this.dealTime=5;this.playerMoney=3000;this.soundsEnabled=true;this.width=1280;this.height=720;this.orientation=c.LANDSCAPE}Object.defineProperty(c,"Instance",{get:function(){if(this.instance===null||this.instance===undefined){this.instance=new c()}return this.instance},enumerable:true,configurable:true});c.prototype.playSound=function(d){if(this.soundsEnabled){}};return c}());b.LANDSCAPE="landscape";b.PORTRAIT="portrait";a.Controller=b})(mygame||(mygame={}));var mygame;(function(b){var a=(function(d){__extends(c,d);function c(){return d!==null&&d.apply(this,arguments)||this}c.prototype.preload=function(){this.load.crossOrigin="anonymous";var e=window.baseURL;this.game.load.image("preloaderBar",e+"assets/Loader-Front.png");this.game.load.image("preloaderBarEmpty",e+"assets/Loader-Back.png")};c.prototype.create=function(){b.Controller.Instance.orientation=b.Controller.LANDSCAPE;if(window.orientation=="p"){b.Controller.Instance.orientation=b.Controller.PORTRAIT}this.game.input.touch.preventDefault=false;this.game.stage.backgroundColor=1907997;this.input.maxPointers=1;this.stage.disableVisibilityChange=true;b.Core.begin(this.game,!this.game.device.desktop);this.game.state.start("Preloader")};return c}(Phaser.State));b.Boot=a})(mygame||(mygame={}));var mygame;(function(a){var b=(function(c){__extends(d,c);function d(){var e=c.call(this,1280,720,Phaser.AUTO,"mdsp-creative",null,false,true)||this;if(window.innerMode=="client"){window.customClientWidth=function(){return document.documentElement.clientWidth};window.customClienHeight=function(){return document.documentElement.clientHeight}}a.Core.init(1280,720);e.state.add("Boot",a.Boot,false);e.state.add("Preloader",a.Preloader,false);e.state.add("PlayState",a.PlayState,false);e.state.start("Boot");return e}return d}(Phaser.Game));a.Game=b})(mygame||(mygame={}));var mygame;(function(c){var a;(function(d){d[d.DISABLED=0]="DISABLED";d[d.ACTIVE=1]="ACTIVE"})(a=c.BlockTypes||(c.BlockTypes={}));var b=(function(e){__extends(d,e);function d(g,f,l,j){var k=e.call(this,g,f,l)||this;k._fieldUpperBound=[];k._followGem1=false;k._followGem2=false;k._followGem3=false;k._background=k.game.add.sprite(600-5,-15,"atlas","Field-01");k._background.inputEnabled=true;k._background.anchor.set(1,0);k.addChild(k._background);k._maxColorStreak=0;k._boomAnimation=false;k._sequences=[];k._playState=j;k._tweenArray=[];k._tempSprite=[];k._destroyed=0;k._turnOffMask=false;k._firstMatch=false;k._finalWasFired=false;k._gameArray=c.GameConfig.gameArray;k._fieldUpperBound=[1,0,0,0,0,0,1,0,0,0,0];k._streak=[];for(var h=0;h<6;h++){k._streak.push(0)}k._disabled=false;k._bgContainer=k.game.add.sprite(0,0);k._bgContainer.anchor.set(0.5,0);k.addChild(k._bgContainer);k._container=k.game.add.sprite(0,0);k._container.anchor.set(0.5,0);k.addChild(k._container);k._myMask=k.game.add.graphics(0,0);k.addChild(k._myMask);k._container.mask=k._myMask;k._myMask.beginFill(16777215);k._myMask.drawRect(c.GameConfig.BLOCK_SIZE,0,5*c.GameConfig.BLOCK_SIZE,c.GameConfig.BLOCK_SIZE);k._myMask.drawRect(0,c.GameConfig.BLOCK_SIZE,7*c.GameConfig.BLOCK_SIZE,c.GameConfig.BLOCK_SIZE*3);k._myMask.drawRect(c.GameConfig.BLOCK_SIZE,c.GameConfig.BLOCK_SIZE*4,5*c.GameConfig.BLOCK_SIZE,c.GameConfig.BLOCK_SIZE);k._myMask.endFill();k.drawField();k._selectedGem=null;if(window.collectable){k._counters=[0,window.firstElement,0,window.secondElement,window.thirdElement,0,100,100]}else{k._counters=[-1,-1,-1,-1,-1,-1,-1,-1]}k.game.input.onUp.add(function(){k.game.input.deleteMoveCallback(k.gemMove,k);if((k._selectedGem!==null&&k._selectedGem!==undefined)&&k._selectedGem.isBomb&&(k._pickedGem==null)){k._removeMap=[];for(var n=0;n<k._gameArray.length;n++){k._removeMap[n]=[];for(var m=0;m<k._gameArray[n].length;m++){k._removeMap[n].push(0)}}k.setOff(k._selectedGem.mytype-5);k.destroyGems()}},k);k._canClick=true;if(window.particleOn){k._fruit1Emmiter=k.game.add.emitter(0,0,50);k.addChild(k._fruit1Emmiter);k._fruit1Emmiter.makeParticles("atlas","F_1");k._fruit1Emmiter.gravity=0;k._fruit1Emmiter.minParticleSpeed.setTo(-300,-300);k._fruit1Emmiter.maxParticleSpeed.setTo(300,300);k._fruit1Emmiter.setAlpha(1,0.1,1200);k._fruit1Emmiter.setScale(1.2,0.1,1.2,0.1,1200,Phaser.Easing.Quintic.Out);k._fruit2Emmiter=k.game.add.emitter(0,0,50);k.addChild(k._fruit2Emmiter);k._fruit2Emmiter.makeParticles("atlas","F_2");k._fruit2Emmiter.gravity=0;k._fruit2Emmiter.minParticleSpeed.setTo(-300,-300);k._fruit2Emmiter.maxParticleSpeed.setTo(300,300);k._fruit2Emmiter.setAlpha(1,0.1,1200);k._fruit2Emmiter.setScale(1.2,0.1,1.2,0.1,1200,Phaser.Easing.Quintic.Out);k._fruit3Emmiter=k.game.add.emitter(0,0,50);k.addChild(k._fruit3Emmiter);k._fruit3Emmiter.makeParticles("atlas","F_3");k._fruit3Emmiter.gravity=0;k._fruit3Emmiter.minParticleSpeed.setTo(-300,-300);k._fruit3Emmiter.maxParticleSpeed.setTo(300,300);k._fruit3Emmiter.setAlpha(1,0.1,1200);k._fruit3Emmiter.setScale(1.2,0.1,1.2,0.1,1200,Phaser.Easing.Quintic.Out);k._fruit4Emmiter=k.game.add.emitter(0,0,50);k.addChild(k._fruit4Emmiter);k._fruit4Emmiter.makeParticles("atlas","F_4");k._fruit4Emmiter.gravity=0;k._fruit4Emmiter.minParticleSpeed.setTo(-300,-300);k._fruit4Emmiter.maxParticleSpeed.setTo(300,300);k._fruit4Emmiter.setAlpha(1,0.1,1200);k._fruit4Emmiter.setScale(1.2,0.1,1.2,0.1,1200,Phaser.Easing.Quintic.Out);k._fruit5Emmiter=k.game.add.emitter(0,0,50);k.addChild(k._fruit5Emmiter);k._fruit5Emmiter.makeParticles("atlas","F_5");k._fruit5Emmiter.gravity=0;k._fruit5Emmiter.minParticleSpeed.setTo(-300,-300);k._fruit5Emmiter.maxParticleSpeed.setTo(300,300);k._fruit5Emmiter.setAlpha(1,0.1,1200);k._fruit5Emmiter.setScale(1.2,0.1,1.2,0.1,1200,Phaser.Easing.Quintic.Out);k._fruitSpecialEmmiter1=k.game.add.emitter(0,0,250);k.game.world.addChild(k._fruitSpecialEmmiter1);k._fruitSpecialEmmiter1.makeParticles("atlas","F_1");k._fruitSpecialEmmiter1.gravity=0;k._fruitSpecialEmmiter1.minParticleSpeed.setTo(-300,-300);k._fruitSpecialEmmiter1.maxParticleSpeed.setTo(300,300);k._fruitSpecialEmmiter1.setAlpha(1,0.1,600);k._fruitSpecialEmmiter1.setScale(1.2,0.1,1.2,0.1,600,Phaser.Easing.Quintic.Out);k._fruitSpecialEmmiter1.start(false,500,5);k._fruitSpecialEmmiter1.on=false;k._fruitSpecialEmmiter2=k.game.add.emitter(0,0,250);k.game.world.addChild(k._fruitSpecialEmmiter2);k._fruitSpecialEmmiter2.makeParticles("atlas","F_3");k._fruitSpecialEmmiter2.gravity=0;k._fruitSpecialEmmiter2.minParticleSpeed.setTo(-300,-300);k._fruitSpecialEmmiter2.maxParticleSpeed.setTo(300,300);k._fruitSpecialEmmiter2.setAlpha(1,0.1,600);k._fruitSpecialEmmiter2.setScale(1.2,0.1,1.2,0.1,600,Phaser.Easing.Quintic.Out);k._fruitSpecialEmmiter2.start(false,500,5);k._fruitSpecialEmmiter2.on=false;k._fruitSpecialEmmiter3=k.game.add.emitter(0,0,250);k.game.world.addChild(k._fruitSpecialEmmiter3);k._fruitSpecialEmmiter3.makeParticles("atlas","F_4");k._fruitSpecialEmmiter3.gravity=0;k._fruitSpecialEmmiter3.minParticleSpeed.setTo(-300,-300);k._fruitSpecialEmmiter3.maxParticleSpeed.setTo(300,300);k._fruitSpecialEmmiter3.setAlpha(1,0.1,600);k._fruitSpecialEmmiter3.setScale(1.2,0.1,1.2,0.1,600,Phaser.Easing.Quintic.Out);k._fruitSpecialEmmiter3.start(false,500,5);k._fruitSpecialEmmiter3.on=false}k._createBomb=false;k._condensationPoint=new Phaser.Point(0,0);return k}Object.defineProperty(d.prototype,"firstMatchCallback",{set:function(f){this._firstMatchCallback=f},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"endMatchCallback",{set:function(f){this._endMatchCallback=f},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"disableField",{set:function(f){this._disabled=f},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"destroyCallback",{set:function(f){this._cb=f},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"finalCallback",{set:function(f){this._finalCallback=f},enumerable:true,configurable:true});d.prototype.gemMove=function(f,i,g){var o=i-this._selectedPoint.x;var n=g-this._selectedPoint.y;var m=0;var p=0;if(Math.abs(o)>c.GameConfig.BLOCK_SIZE/2){if(o>0){p=1}else{p=-1}}else{if(Math.abs(n)>c.GameConfig.BLOCK_SIZE/2){if(n>0){m=1}else{m=-1}}}if(m+p!=0){var j=this._selectedGem.row+m;var l=this._selectedGem.col+p;if(j>=0&&j<this._gameArray.length&&l>=0&&l<this._gameArray[0].length){this._pickedGem=this._gameArray[this._selectedGem.row+m][this._selectedGem.col+p];if(this._pickedGem.mytype>0){this._selectedGem.deselect();this.swapGems(true);this.game.input.deleteMoveCallback(this.gemMove,this)}else{this._pickedGem=null}}else{this._pickedGem=null}}};d.prototype.drawField=function(){var l=this;for(var h=0;h<this._gameArray.length;h++){var f=function(m){var o=k._gameArray[h][m];var i=c.GameConfig.BLOCK_SIZE*(m+0.5);var p=c.GameConfig.BLOCK_SIZE*(h+0.5);if(o>0){var n=new c.Gem(k.game,i,p,o);k._container.addChild(n);n.inputEnabled=true;n.row=h;n.col=m;n.events.onInputDown.add(function(q,r){var j;j=window.tutorial&&(n.row==2)&&(n.mytype==2)||!window.tutorial;j=j||window.tutorial&&(n.col==3)&&(n.mytype==4);if(l._canClick&&j&&!l._disabled){if(l._selectedGem==null){l._selectedGem=n;l._selectedPoint=new Phaser.Point(r.x,r.y);n.select();l.game.input.addMoveCallback(l.gemMove,l)}else{l.gemSelect(n)}}},k);k._gameArray[h][m]=n}else{k._gameArray[h][m]=new c.Gem(k.game,i,p,0);k._gameArray[h][m].row=h;k._gameArray[h][m].col=m}};var k=this;for(var g=0;g<this._gameArray[h].length;g++){f(g)}}if(window.tutorial){this._border=this.game.add.sprite(2.5*c.GameConfig.BLOCK_SIZE,2.5*c.GameConfig.BLOCK_SIZE,"atlas","Help-Frame-01");this._border.anchor.set(0.5);this._borderTween=this.game.add.tween(this._border.scale).to({x:1.2,y:1.2},500,Phaser.Easing.Sinusoidal.InOut,true,0,-1,true);this._container.addChild(this._border)}};d.prototype.endGame=function(){var h=this;for(var g=0;g<this._gameArray.length;g++){for(var f=0;f<this._gameArray[g].length;f++){this._gameArray[g][f].inputEnabled=false}}setTimeout(function(){h._finalCallback()},1000)};d.prototype.clearTweens=function(){if(this._tweenArray.length>0){for(var g=0;g<this._tweenArray.length;g++){if(this._tweenArray[g]!=null){this.game.tweens.remove(this._tweenArray[g])}}}this._tweenArray=[];if(this._tempSprite.length>0){for(var g=0;g<this._tempSprite.length;g++){if(this._tempSprite[g]!=null){this._tempSprite[g].destroy(true)}}}this._tempSprite=[];for(var g=0;g<this._gameArray.length;g++){for(var f=0;f<this._gameArray[g].length;f++){if(this._gameArray[g][f]!=null){this._gameArray[g][f].clearTweens()}}}};d.prototype.replay=function(){this._disabled=false;this._finalWasFired=false;if(window.collectable){this._counters=[0,window.firstElement,0,window.secondElement,window.thirdElement,0,100,100]}else{this._counters=[-1,-1,-1,-1,-1,-1,-1,-1]}};d.prototype.gemSelect=function(f){if(this._selectedGem==null){return}if(this._selectedGem.isSame(f)){this._selectedGem.deselect();this._selectedGem=null;return}if(this._selectedGem.isNext(f)){this._selectedGem.deselect();this._pickedGem=f;this.swapGems()}else{this._selectedGem.deselect();this._selectedGem=f;f.select()}};d.prototype.resetBoard=function(){for(var g=0;g<this._gameArray.length;g++){for(var f=0;f<this._gameArray[0].length;f++){if(this._gameArray[g][f].mytype>0){this._gameArray[g][f].mytype=c.GameConfig.gameArrayLandscape[g][f]}}}this._canClick=true};d.prototype.moveExists=function(){var l="";var f=6;for(var h=0;h<this._gameArray.length;h++){for(var g=0;g<this._gameArray[h].length;g++){if(this._gameArray[h][g].mytype<0){l+="0"}else{l+=this._gameArray[h][g].mytype}if(this._gameArray[h][g].mytype>5){return true}}l+=f;f++;if(f>9){f=6}l+="\n"}var m=/(\d)(?:.|(?:.|\n){9}|(?:.|\n){6})?\1\1|(\d)\2(?:.|(?:.|\n){9}|(?:.|\n){6})?\2|(\d)(?:.|\n){7}\3(?:.|(?:.|\n){9})\3|(\d)(?:.|(?:.|\n){9})\4(?:.|\n){7}\4|(\d)(?:(?:.|\n){7,9}|(?:.|\n){17})\5(?:.|\n){8}\5|(\d)(?:.|\n){8}\6(?:(?:.|\n){7,9}|(?:.|\n){17})\6/;if(m.exec(l)==null){return false}return true};d.prototype.swapGems=function(s){var r=this;if(s===void 0){s=true}if(window.tutorial){var v=Math.min(this._selectedGem.col,this._pickedGem.col);var w=Math.max(this._selectedGem.col,this._pickedGem.col);if(Math.abs(this._pickedGem.col-this._selectedGem.col)!=1||(v!=2&&w!=3)){this._selectedGem=null;this._pickedGem=null;return}else{window.tutorial=false;for(var o=0;o<this._gameArray.length;o++){for(var m=0;m<this._gameArray[o].length;m++){this._playState.destroyTutorial();this._borderTween.stop();this._border.destroy()}}}}this._canClick=false;this._coolAnimation=true;this._verticalAnimation=false;this._gameArray[this._selectedGem.row][this._selectedGem.col]=this._pickedGem;this._gameArray[this._pickedGem.row][this._pickedGem.col]=this._selectedGem;var q=this._selectedGem.row;var t=this._selectedGem.col;var u=this._pickedGem.row;var h=this._pickedGem.col;this._selectedGem.row=u;this._selectedGem.col=h;this._pickedGem.row=q;this._pickedGem.col=t;var k=new Phaser.Point((h+0.5)*c.GameConfig.BLOCK_SIZE,(u+0.5)*c.GameConfig.BLOCK_SIZE);var g=new Phaser.Point((t+0.5)*c.GameConfig.BLOCK_SIZE,(q+0.5)*c.GameConfig.BLOCK_SIZE);var p=this.game.add.tween(this._selectedGem).to({x:k.x,y:k.y},c.GameConfig.SWAP_TIME,Phaser.Easing.Linear.None,false);this._tweenArray.push(p);var f=this.game.add.tween(this._pickedGem).to({x:g.x,y:g.y},c.GameConfig.SWAP_TIME,Phaser.Easing.Linear.None,false);this._tweenArray.push(f);var n=this._selectedGem.mytype;var l=this._pickedGem.mytype;f.onComplete.add(function(){if(r._selectedGem!==null&&r._selectedGem!==undefined&&r._pickedGem!==undefined&&r._pickedGem!==null&&(r._selectedGem.isBomb||r._pickedGem.isBomb)){r._removeMap=[];for(var y=0;y<r._gameArray.length;y++){r._removeMap[y]=[];for(var x=0;x<r._gameArray[y].length;x++){r._removeMap[y].push(0)}}if(r._selectedGem.isBomb){r.setOff(r._selectedGem.mytype-5,r._selectedGem.row,r._selectedGem.col);r.destroyGems()}else{r._selectedGem=r._pickedGem;r.setOff(r._selectedGem.mytype-5,r._selectedGem.row,r._selectedGem.col);r.destroyGems()}}else{if(r.isMatchOnBoard(u,h,n,q,t,l)){r.handleMatches();r._selectedGem=null;r._pickedGem=null}else{if(s){r.swapGems(false)}}}},this);f.start();p.start();if(!s){this._selectedGem.deselect();this._selectedGem=null;this._pickedGem=null;this._canClick=true}};d.prototype.isMatchOnBoard=function(j,k,f,g,i,h){return this.isMatch(j,k,f)||this.isMatch(g,i,h)};d.prototype.isMatch=function(h,f,g){return this.isHorizontal(h,f,g)||this.isVertical(h,f,g)};d.prototype.isHorizontal=function(n,k,m){var o;var g;var f=0;for(var l=0;l<3;l++){f=0;o=k+l;g=o-2;if(o>=this._gameArray[0].length){continue}if(g<0){continue}for(var h=o;h>=g;h--){if(this._gameArray[n][h].mytype==m){f++}}if(f>2){return true}}return false};d.prototype.setOff=function(l,f,r){if(f==null){if(!this._selectedGem.isBomb||l<1){return}if(!this._canClick){return}}this._canClick=false;this._boomAnimation=true;var q;if(f!==undefined&&f!==null){q=new Phaser.Point(f,r)}else{q=new Phaser.Point(this._selectedGem.row,this._selectedGem.col);this._selectedGem.stopTween()}this._selectedGem=null;this._pickedGem=null;switch(l){case 1:for(var n=-1;n<2;n++){var g=void 0;var o=void 0;if(q.x+n>=0&&q.x+n<this._gameArray.length){g=q.x+n;o=q.y;if(this._gameArray[g][o].isBomb&&(g!=q.x||o!=q.y)&&this._removeMap[g][o]==0){this.setOff(this._gameArray[g][o].mytype-5,g,o)}if(this._gameArray[g][o].mytype>0){this._removeMap[g][o]=1}}if(q.y+n>=0&&q.y+n<this._gameArray[0].length){g=q.x;o=q.y+n;if(this._gameArray[g][o].isBomb&&(g!=q.x||o!=q.y)&&this._removeMap[g][o]==0){this.setOff(this._gameArray[g][o].mytype-5,g,o)}if(this._gameArray[g][o].mytype>0){this._removeMap[g][o]=1}}}break;case 2:var g=void 0;var o=void 0;for(var n=-2;n<3;n++){if(q.x+n>=0&&q.x+n<this._gameArray.length){g=q.x+n;o=q.y;if(this._gameArray[g][o].isBomb&&(g!=q.x||o!=q.y)&&this._removeMap[g][o]==0){this.setOff(this._gameArray[g][o].mytype-5,g,o)}if(this._gameArray[g][o].mytype>0){this._removeMap[g][o]=1}}if(q.y+n>=0&&q.y+n<this._gameArray[0].length){g=q.x;o=q.y+n;if(this._gameArray[g][o].isBomb&&(g!=q.x||o!=q.y)&&this._removeMap[g][o]==0){this.setOff(this._gameArray[g][o].mytype-5,g,o)}if(this._gameArray[g][o].mytype>0){this._removeMap[g][o]=1}}}for(var n=-1;n<2;n++){for(var m=-1;m<2;m++){if(q.x+n>=0&&q.x+n<this._gameArray.length){if(q.y+m>=0&&q.y+m<this._gameArray[0].length){g=q.x+n;o=q.y+m;if(this._gameArray[g][o].isBomb&&(g!=q.x||o!=q.y)&&this._removeMap[g][o]==0){this.setOff(this._gameArray[g][o].mytype-5,g,o)}if(this._gameArray[g][o].mytype>0){this._removeMap[g][o]=1}}}}}break}this._coolAnimation=false};d.prototype.isVertical=function(n,k,m){var o;var g;var f=0;for(var h=0;h<3;h++){f=0;o=n+h;g=o-2;if(o>=this._gameArray.length){continue}if(g<0){continue}for(var l=o;l>=g;l--){if(this._gameArray[l][k].mytype==m){f++}}if(f>2){return true}}return false};d.prototype.handleMatches=function(){var h=this;if(!this._firstMatch){this._firstMatch=true;if(this._firstMatchCallback){this._firstMatchCallback()}}this._removeMap=[];for(var g=0;g<this._gameArray.length;g++){this._removeMap[g]=[];for(var f=0;f<this._gameArray[g].length;f++){this._removeMap[g].push(0)}}this.handleHorizontalMatches();this.handleVerticalMatches();this._sequences.forEach(function(j){for(var k=0;k<j.length;k++){var l=j.get(k);h._removeMap[l.x][l.y]=1}});this.destroyGems();this._coolAnimation=false};d.prototype.destroyGems=function(){var k=this;this._destroyed=0;var h;var j;if(this._selectedGem!=null){if(this._removeMap[this._selectedGem.row][this._selectedGem.col]>0){h=new Phaser.Point(this._selectedGem.x,this._selectedGem.y);j=this._selectedGem.mytype;this._condensationPoint.set(this._selectedGem.row,this._selectedGem.col);var f=0;while(f<this._sequences.length){var g=this._sequences[f];if(g.contains(this._condensationPoint.x,this._condensationPoint.y)){if(g.isBomb){g.setBombPosition(this._condensationPoint.x,this._condensationPoint.y)}break}f++}}else{if(this._removeMap[this._pickedGem.row][this._pickedGem.col]>0){h=new Phaser.Point(this._pickedGem.x,this._pickedGem.y);j=this._pickedGem.mytype;this._condensationPoint.set(this._pickedGem.row,this._pickedGem.col);var f=0;while(f<this._sequences.length){var g=this._sequences[f];if(g.contains(this._condensationPoint.x,this._condensationPoint.y)){if(g.isBomb){g.setBombPosition(this._condensationPoint.x,this._condensationPoint.y)}break}f++}}else{h=new Phaser.Point(1,1);j=0}}}this._coolAnimation=false;if(this._coolAnimation){this.condensate(h)}else{setTimeout(function(){var p=[];var q=[];var m=0;for(var n=0;n<k._removeMap.length;n++){var r=function(s){if(k._removeMap[n][s]>0){k._destroyed++;var v=k._gameArray[n][s];if((v.mytype==1||v.mytype==3||v.mytype==4)&&k._counters[v.mytype]>0){var i=void 0;if(v.mytype==1){i=k._playState.getGurrentElementPosition("first")}else{if(v.mytype==3){i=k._playState.getGurrentElementPosition("second")}else{if(v.mytype==4){i=k._playState.getGurrentElementPosition("third")}}}var w=v.worldPosition.x;var u=v.worldPosition.y;k._container.removeChild(v);k.game.world.addChild(v);k._tempSprite.push(v);v.position.set(w,u);var t=k.createFlyTween(v,i,m);m+=100;q.push(t)}else{v.onDestroy=function(){k._destroyed--;k._counters[v.mytype]-=1;k._cb(v.mytype,1);if(k._destroyed==0){k.makeGemsFall();if(k._boomAnimation){k._boomAnimation=false}}};p.push(v)}}};for(var l=0;l<k._removeMap[n].length;l++){r(l)}}var o=0;p.forEach(function(i){if(k._boomAnimation){i.boomAnimation()}else{i.playDestroy();if(window.particleOn){switch(i.mytype){case 1:k._fruit1Emmiter.x=i.x;k._fruit1Emmiter.y=i.y;k._fruit1Emmiter.start(true,1100,null,7);break;case 2:k._fruit2Emmiter.x=i.x;k._fruit2Emmiter.y=i.y;k._fruit2Emmiter.start(true,1100,null,7);break;case 3:k._fruit3Emmiter.x=i.x;k._fruit3Emmiter.y=i.y;k._fruit3Emmiter.start(true,1100,null,7);break;case 4:k._fruit4Emmiter.x=i.x;k._fruit4Emmiter.y=i.y;k._fruit4Emmiter.start(true,1100,null,7);break;case 5:k._fruit5Emmiter.x=i.x;k._fruit5Emmiter.y=i.y;k._fruit5Emmiter.start(true,1100,null,7);break;default:break}}}});q.forEach(function(i){return i.start()})},10)}};d.prototype.handleHorizontalMatches=function(){var h=function(q){var r=1;var p=-100500;var m=0;for(var o=0;o<g._gameArray[q].length;o++){if(g._gameArray[q][o].mytype==p&&g._gameArray[q][o].mytype>0){r++;if(r>=4){g._createBomb=true;g._maxColorStreak=Math.max(g._maxColorStreak,r)}}if(g._gameArray[q][o].mytype!=p||o==g._gameArray[q].length-1){if(r>=3){var t=new c.Sequence();g._sequences.push(t);if(g._counters[p]<=0||!g._coolAnimation){g._coolAnimation=false}var s=g._sequences.length-1;var l=function(i){var j=s;g._sequences.forEach(function(k,u){if(k.contains(q,m+i)){j=u}});if(j!=s){g._sequences[j].merge(t);t=g._sequences[j];s=j}else{t.add(q,m+i)}};for(var n=0;n<r;n++){l(n)}}m=o;r=1;p=g._gameArray[q][o].mytype}}};var g=this;for(var f=0;f<this._gameArray.length;f++){h(f)}};d.prototype.handleVerticalMatches=function(){var h=function(p){var q=1;var o=-100500;var l=0;for(var n=0;n<g._gameArray.length;n++){if(g._gameArray[n][p].mytype==o&&g._gameArray[n][p].mytype>0){q++;if(q>=4){g._createBomb=true;g._maxColorStreak=Math.max(g._maxColorStreak,q)}}if(g._gameArray[n][p].mytype!=o||n==g._gameArray.length-1){if(q>=3){var t=new c.Sequence();g._sequences.push(t);var r=g._sequences.length-1;if(g._counters[o]<=0||!g._coolAnimation){g._coolAnimation=false}else{g._verticalAnimation=true}var s=function(i){var j=r;g._sequences.forEach(function(k,u){if(k.contains(l+i,p)){j=u}});if(j!=r){g._sequences[j].merge(t);t=g._sequences[j];r=j}else{t.add(l+i,p)}};for(var m=0;m<q;m++){s(m)}}l=n;q=1;o=g._gameArray[n][p].mytype}}};var g=this;for(var f=0;f<this._gameArray[0].length;f++){h(f)}};d.prototype.checkGlobalMatch=function(){for(var g=0;g<this._gameArray.length;g++){for(var f=0;f<this._gameArray[g].length;f++){if(this._gameArray[g][f].mytype<=0){continue}if(this.isMatch(g,f,this._gameArray[g][f].mytype)){return true}}}return false};d.prototype.swap=function(i,k,h,j,g){if(g===void 0){g=0}var f=this._gameArray[i][k];f.row=h-g;f.col=j;this._gameArray[i][k]=this._gameArray[h][j];this._gameArray[i][k].row=i-g;this._gameArray[i][k].col=k;this._gameArray[h][j]=f};d.prototype.makeGemsFall=function(){var r=this;if(this._destroyed>0){this.game.time.events.add(200,this.makeGemsFall,this)}this._sequences.forEach(function(i){if(i.isBomb){var w=i.bombPosition;r._removeMap[w.x][w.y]=0;var x=r._gameArray[w.x][w.y];try{r.game.world.removeChild(x);r._container.addChild(x)}catch(k){}x.x=(x.col+0.5)*c.GameConfig.BLOCK_SIZE;x.y=(x.row+0.5)*c.GameConfig.BLOCK_SIZE;x.spawnBoom(i.length);r._maxColorStreak=0;r._createBomb=false;r._boomAnimation=false}});if(this._turnOffMask){this._turnOffMask=false;this._container.mask=this._myMask}this._sequences.length=0;var n=this.findHoles();var s=[];var j=0;for(var m=0;m<n.length;m++){var f=n[m];var t=void 0;var g=void 0;var l=void 0;if(f.hasHoleAbove){t=n[m+1];g=t.row+t.length-f.length;l=f.row-g}else{g=0;l=f.row-this._fieldUpperBound[f.col]}for(var o=0;o<l;o++){this.swap(f.row-1-o,f.col,f.row+f.length-1-o,f.col)}if(!f.hasHoleAbove){for(var o=this._fieldUpperBound[f.col];o<this._fieldUpperBound[f.col]+f.length;o++){var p=this._gameArray[o][f.col];var h=this.game.rnd.between(1,5);p.mytype=h;p.x=(f.col+0.5)*c.GameConfig.BLOCK_SIZE;p.y=(p.row-f.length+0.5)*c.GameConfig.BLOCK_SIZE}g=this._fieldUpperBound[f.col];l=f.row+f.length}else{var q=f.row-(t.row+t.length-f.length);g=f.row+f.length-q;l=f.row+f.length}var v=function(w){var x=u._gameArray[w][f.col];j++;var k=u.game.add.tween(x).to({y:x.y+f.length*c.GameConfig.BLOCK_SIZE},c.GameConfig.FALLDOWN_TIME,Phaser.Easing.Back.Out,false);u._tweenArray.push(k);k.onComplete.add(function(){r._gameArray[x.row][x.col]=x;j--;if(j==0){if(r.checkGlobalMatch()){r.handleMatches()}else{if(!r.moveExists()){r.resetBoard()}else{r._canClick=true}r._selectedGem=null;if(!r._finalWasFired){var i=0;for(var y=0;y<r._counters.length;y++){if(r._counters[y]<=0){i++}if(i==r._counters.length-2){r._finalWasFired=true;c.GameConfig.COUNTERS_PUBLIC=[0,window.firstElement,0,window.secondElement,window.thirdElement,0,100,100];r.endGame()}}}}}});s.push(k)};var u=this;for(var o=g;o<l;o++){v(o)}}s.forEach(function(i){return i.start()})};d.prototype.createFlyTween=function(k,h,f){var j=this;var i=this.game.add.tween(k.scale).to({x:c.GameConfig.PANEL_GEM_SCALE,y:c.GameConfig.PANEL_GEM_SCALE},c.GameConfig.FLY_TIME,Phaser.Easing.Sinusoidal.InOut,false);this._tweenArray.push(i);i.onComplete.addOnce(function(){k.scale.setTo(1)},this);var g=this.game.add.tween(k).to({x:h.x,y:h.y},c.GameConfig.FLY_TIME,Phaser.Easing.Sinusoidal.InOut,false,f);this._tweenArray.push(g);if(k.mytype==1){this._gem1ToFollow=k}else{if(k.mytype==3){this._gem2ToFollow=k}else{if(k.mytype==4){this._gem3ToFollow=k}}}g.onStart.addOnce(function(){if(window.particleOn){if(k.mytype==1){if(j._gem1ToFollow==k){j._fruitSpecialEmmiter1.x=j._gem1ToFollow.x;j._fruitSpecialEmmiter1.y=j._gem1ToFollow.y;j._fruitSpecialEmmiter1.on=true;j._followGem1=true}}else{if(k.mytype==3){if(j._gem2ToFollow==k){j._fruitSpecialEmmiter2.x=j._gem2ToFollow.x;j._fruitSpecialEmmiter2.y=j._gem2ToFollow.y;j._fruitSpecialEmmiter2.on=true;j._followGem2=true}}else{if(k.mytype==4){if(j._gem3ToFollow==k){j._fruitSpecialEmmiter3.x=j._gem3ToFollow.x;j._fruitSpecialEmmiter3.y=j._gem3ToFollow.y;j._fruitSpecialEmmiter3.on=true;j._followGem3=true}}}}}i.start()});g.onComplete.add(function(n,m){if(k){if(window.particleOn){if(k.mytype==1){if(j._gem1ToFollow==k){j._fruitSpecialEmmiter1.on=false;j._followGem1=false}}else{if(k.mytype==3){if(j._gem2ToFollow==k){j._fruitSpecialEmmiter2.on=false;j._followGem2=false}}else{if(k.mytype==4){if(j._gem3ToFollow==k){j._fruitSpecialEmmiter3.on=false;j._followGem3=false}}}}for(var l=void 0;l<j._tempSprite.length;l++){if(j._tempSprite[l]==k){j._tempSprite.splice(l,1);break}}}j.game.world.removeChild(k);j._container.addChild(k);k.position.set(-1500,-1500);j._destroyed--;j._cb(k.mytype,1);j._counters[k.mytype]--;if(j._boomAnimation){j._boomAnimation=false}if(j._destroyed==0){j.makeGemsFall()}}},this);return g};d.prototype.updateSpecialGemEmmiter=function(){if(window.particleOn){if(this._followGem1){this._fruitSpecialEmmiter1.x=this._gem1ToFollow.x;this._fruitSpecialEmmiter1.y=this._gem1ToFollow.y}if(this._followGem2){this._fruitSpecialEmmiter2.x=this._gem2ToFollow.x;this._fruitSpecialEmmiter2.y=this._gem2ToFollow.y}if(this._followGem3){this._fruitSpecialEmmiter3.x=this._gem3ToFollow.x;this._fruitSpecialEmmiter3.y=this._gem3ToFollow.y}}};Object.defineProperty(d.prototype,"gameArray",{get:function(){var f=[];for(var h=0;h<this._gameArray.length;h++){f.push([]);for(var g=0;g<this._gameArray[h].length;g++){f[h][g]=this._gameArray[h][g].mytype}}return f},enumerable:true,configurable:true});d.prototype.generateFlyAwayTween=function(k,i,g,f){this._container.removeChild(k);this.addChild(k);var j=this.createFlyTween(k,g,f);if(this._verticalAnimation){return j}else{var h=this.game.add.tween(k).to({x:i.x},c.GameConfig.CONDENSATION_TIME,Phaser.Easing.Linear.None,false);this._tweenArray.push(h);h.onComplete.add(function(m,l){j.start()});return h}};d.prototype.condensate=function(f){var m=[];var h=0;for(var k=0;k<this._removeMap.length;k++){for(var g=0;g<this._removeMap[k].length;g++){if(this._removeMap[k][g]>0){this._destroyed++;var n=this._gameArray[k][g];var l=void 0;if(n.mytype==2){l=this._playState.getGurrentElementPosition("second")}else{l=this._playState.getGurrentElementPosition("first")}m.push(this.generateFlyAwayTween(n,f,l,h));m[m.length-1].onStart.addOnce(function(){});h+=100}}}m.forEach(function(i){i.start()})};d.prototype.findHoles=function(){var q=[];for(var l=0;l<this._gameArray[0].length;l++){for(var m=this._gameArray.length-1;m>=0;m--){if(this._removeMap[m][l]>0){var g=1;var n=m;var o=true;var p=false;for(var h=m-1;h>=0;h--){if(this._removeMap[h][l]>0){g++;n=h;o=true;p=false}else{if(o){q.push({row:n,col:l,length:g,hasHoleAbove:false});o=false;p=true;var f=q.length-2;if(f>=0&&q[f].col==q[f+1].col){q[f].hasHoleAbove=true}}}}if(!p){q.push({row:n,col:l,length:g,hasHoleAbove:false});var f=q.length-2;if(f>=0&&q[f].col==q[f+1].col){q[f].hasHoleAbove=true}}break}}}return q};d.prototype.update=function(){this.updateSpecialGemEmmiter()};d.prototype.destroy=function(){var f=this;this.clearTweens();setTimeout(function(){f.game.input.onUp.removeAll(f);f.game.tweens.removeFrom(f,true);e.prototype.destroy.call(f,true)},10)};return d}(Phaser.Sprite));c.Field=b})(mygame||(mygame={}));var mygame;(function(a){var b=(function(){function c(){}c.deepClone=function(e){var d=[];for(var g=0;g<e.length;g++){d.push([]);for(var f=0;f<e[0].length;f++){d[g].push(e[g][f])}}return d};c.transpose=function(e){var d=[];for(var g=0;g<e[0].length;g++){d.push([]);for(var f=0;f<e.length;f++){d[g].push(e[f][g])}}return d};c.enableDrag=function(d){return};return c}());b.BLOCK_SIZE=84;b.SWAP_TIME=150;b.DESTROY_TIME=150;b.FALLDOWN_TIME=400;b.FLY_TIME=500*1.15;b.CONDENSATION_TIME=300;b.COUNTERS=[0,2,1,0,0,0,0,0];b.COUNTERS_PUBLIC=[0,2,1,0,0,0,0,0];b.NAMES=["apple","apple","grapes","flower","pear","leaf"];b.PANEL_GEM_SCALE=0.8;b.APPLE_POS=new Phaser.Point(100,-60);b.GRAPES_POS=new Phaser.Point(370,-60);b.UNLOCK_OBJ_PER_FRUITS=3;b.GEM_DEFAULT_SCALE=0.9;b.gameArrayLandscape=[[-1,5,3,2,4,1,-1],[2,3,3,2,1,1,5],[3,1,2,4,4,5,1],[4,3,5,2,4,5,1],[-1,5,4,1,5,4,-1]];a.GameConfig=b})(mygame||(mygame={}));var mygame;(function(a){var b=(function(d){__extends(c,d);function c(f,e,i,g){var h=d.call(this,f,e,i)||this;h._tempTweenArray=[];h._mytype=g;h._spriteName=a.GameConfig.NAMES[h._mytype];if(g>0){h._sprite=h.game.add.sprite(0,0,"atlas","F_"+h._mytype);h._sprite.anchor.set(0.5);h._sprite.scale.set(a.GameConfig.GEM_DEFAULT_SCALE);h.addChild(h._sprite);h._boom=h.game.add.sprite(0,0,"boom_anim","b_1");h._boom.anchor.set(0.5);h._boom.visible=false;h.addChild(h._boom);h._destroyAnimation=h._sprite.animations.add("set off",Phaser.Animation.generateFrameNames("e_",1,7),18,false);h._destroyAnimation.onStart.add(function(){h._sprite.alpha=1},h);h._boomAnimation=h._boom.animations.add("bomb",Phaser.Animation.generateFrameNames("b_",1,10),18,false);h._boomAnimation.onComplete.add(function(){h._boom.visible=false;h.animationEnd()},h);h._bombBoomAnimation=h._boom.animations.add("b_bomb",Phaser.Animation.generateFrameNames("bb_",1,10),18,false);h._bombBoomAnimation.onComplete.add(function(){h._boom.visible=false;h.animationEnd()},h);h._border=h.game.add.sprite(0,0,"atlas","Help-Frame-01");h._border.anchor.set(0.5);h._border.scale.set(1);h.addChild(h._border);h._border.alpha=0;h._destroyAnimation.onComplete.add(function(){h.animationEnd()},h);h._bombTween=h.game.add.tween(h._sprite.scale).to({x:1.1,y:1.1},500,Phaser.Easing.Sinusoidal.InOut,false,0,-1,true)}return h}c.prototype.animationEnd=function(){if(!this._onCompleteFired){this._onCompleteFired=true;this._sprite.alpha=0;if(this._destroyCallback){this._onCompleteFired=true;this._destroyCallback()}}};c.prototype.boomAnimation=function(){this._boom.visible=true;this._sprite.alpha=0;if(this._mytype>=6){this._bombBoomAnimation.play()}else{this._boomAnimation.play()}};c.prototype.spawnBoom=function(e){var f=this;if(e>3){this._border.alpha=0;this._sprite.scale.set(0.1);if(e==4){this._sprite.loadTexture("atlas","rocket");this._mytype=6}else{this._sprite.loadTexture("atlas","bomb");this._mytype=7}this.game.add.tween(this._sprite.scale).to({x:0.7,y:0.7},400,Phaser.Easing.Sinusoidal.InOut,true).onComplete.addOnce(function(){f._sprite.scale.set(0.7);f._bombTween=f.game.add.tween(f._sprite.scale).to({x:1.1,y:1.1},500,Phaser.Easing.Sinusoidal.InOut,true,0,-1,true)},this);this._sprite.alpha=1;this._onCompleteFired=false;this._destroyAnimation.stop()}};c.prototype.stopTween=function(){this._bombTween.pause();this._sprite.loadTexture("atlas","F_2");this._sprite.alpha=0};Object.defineProperty(c.prototype,"row",{get:function(){return this._row},set:function(e){this._row=e},enumerable:true,configurable:true});Object.defineProperty(c.prototype,"col",{get:function(){return this._col},set:function(e){this._col=e},enumerable:true,configurable:true});Object.defineProperty(c.prototype,"mytype",{get:function(){return this._mytype},set:function(e){this._border.alpha=0;if(!this._onCompleteFired){this._destroyAnimation.stop();this._onCompleteFired=true}this._destroyAnimation.stop();this._mytype=e;if(e<6){this._bombTween.pause();this._sprite.position.set(0,0);this._sprite.scale.set(a.GameConfig.GEM_DEFAULT_SCALE,a.GameConfig.GEM_DEFAULT_SCALE);this._spriteName=a.GameConfig.NAMES[this._mytype];this._sprite.loadTexture("atlas","F_"+this._mytype)}else{this._bombTween.start();this._spriteName="rocket";this._sprite.loadTexture("atlas","rocket");this._sprite.scale.set(2,2)}this._sprite.alpha=1;this._onCompleteFired=false},enumerable:true,configurable:true});Object.defineProperty(c.prototype,"onDestroy",{set:function(e){this._destroyCallback=e},enumerable:true,configurable:true});Object.defineProperty(c.prototype,"isBomb",{get:function(){return this._mytype>=6},enumerable:true,configurable:true});c.prototype.playDestroy=function(){var f=this;this._border.alpha=0;if(this.mytype==6){this._bombTween.pause()}var e=this.game.add.tween(this._sprite.scale).to({x:0.15,y:0.15},100,Phaser.Easing.Sinusoidal.Out,true);this._tempTweenArray.push(e);e.onComplete.addOnce(function(){f._sprite.scale.set(a.GameConfig.GEM_DEFAULT_SCALE);f._destroyAnimation.play()})};c.prototype.select=function(){if(!window.tutorial){this._sprite.scale.set(a.GameConfig.GEM_DEFAULT_SCALE+0.2);if(this.mytype<6){this._border.alpha=1}}};c.prototype.deselect=function(){this._sprite.scale.set(a.GameConfig.GEM_DEFAULT_SCALE);this._border.alpha=0};c.prototype.isSame=function(e){return(this._row==e.row)&&(this._col==e.col)};c.prototype.isNext=function(e){return Math.abs(this.row-e.row)+Math.abs(this.col-e.col)==1};return c}(Phaser.Sprite));a.Gem=b})(mygame||(mygame={}));var mygame;(function(a){var b=(function(){function c(){this.CONGRAT={en:"Congratulations!",de:"  Herzlichen Gluckwunsch !"};this.PLOT={en:"The plot\nis restored!",de:"Ein Grundstuck\nrestauriert!"};this.TUTORIAL={en:"Collect fruits to upgrade garden!",de:"Sammeln Sie Fruchte,\num den Garten zu verbessern!"}}Object.defineProperty(c,"Instance",{get:function(){if(this.instance===null||this.instance===undefined){this.instance=new c()}return this.instance},enumerable:true,configurable:true});return c}());b.loc="en";a.Lang=b})(mygame||(mygame={}));var mygame;(function(a){var b=(function(c){__extends(d,c);function d(n,m,j){var g=c.call(this,n,m,j)||this;g._unclocksCounter=0;g._benches=new Array(2);g._brightBenches=new Array(2);g._fontains=new Array(2);g._leafs=[];g._leafs[0]=g.game.add.sprite(240,-450,"atlas","Back-02");g._leafs[0].angle=25;g._leafs[1]=g.game.add.sprite(240,0,"atlas","Back-02");g._leafs[1].angle=25;g._leafs[2]=g.game.add.sprite(0,100,"atlas","Back-02");g._leafs[2].angle=-45;g._leafs.forEach(function(i){return g.addChild(i)});g._myMask=g.game.add.graphics(-23,-16);g.addChild(g._myMask);g._myMask.beginFill(16777215);g._myMask.drawRoundedRect(-500/2,-600,545,688-2,30);g._myMask.endFill();g._fountain=g.game.add.sprite(0,110,"atlas","Build-05");g._fountain.anchor.set(0.5,1);g._fountain.mask=g._myMask;g.addChild(g._fountain);var e=g.game.add.sprite(180,-505,"atlas","Build-02");e.alpha=0;e.anchor.set(0.5);g._benches[0]=e;g._fountain.addChild(e);var l=g.game.add.sprite(-200,-505,"atlas","Build-02");l.scale.set(-1,1);l.alpha=0;l.anchor.set(0.5);g._fountain.addChild(l);g._benches[1]=l;var k=g.game.add.sprite(0,0,"atlas","Build-02");k.anchor.set(0.5);k.blendMode=PIXI.blendModes.ADD;e.addChild(k);var h=g.game.add.sprite(0,0,"atlas","Build-02");h.anchor.set(0.5);h.blendMode=PIXI.blendModes.ADD;l.addChild(h);g._brightBenches[0]=k;g._brightBenches[1]=h;g._border=g.game.add.sprite(0,70-688/2,"atlas","Build-01");g._border.anchor.set(0.5,0.5);g.addChild(g._border);g._fontains[0]=g.game.add.sprite(-115+221/2,-455+120/2,"atlas","Build-03");g._fontains[0].anchor.set(0.5);g._fontains[0].alpha=0;g._fountain.addChild(g._fontains[0]);g._fontains[1]=g.game.add.sprite(0,0,"atlas","Build-03");g._fontains[1].anchor.set(0.5);g._fontains[1].blendMode=PIXI.blendModes.ADD;g._fontains[1].alpha=0;g._fontains[0].addChild(g._fontains[1]);g._fountain.addChild(g._fontains[0]);g._trash=g.game.add.sprite(35,-395,"atlas","Build-04");g._trash.anchor.set(0.5);g._fountain.addChild(g._trash);g._trash2=g.game.add.sprite(35,-395,"atlas","Build-04");g._trash2.anchor.set(0.5);g._trash2.blendMode=PIXI.blendModes.ADD;g._trash2.alpha=0;g._fountain.addChild(g._trash2);g._sprite=g.game.add.sprite(0,0,"atlas","Quest-Board-01");g._sprite.anchor.set(0.5);g.addChild(g._sprite);g._fruitsCounter=0;g._finishWasFired=false;g._fruitScale=0.8;g._leaf1=g.game.add.sprite(-300,-200,"atlas","Back-01");g._border.addChild(g._leaf1);g._myCounter=[0,window.firstElement,0,window.secondElement,window.thirdElement,0];a.GameConfig.COUNTERS_PUBLIC=g._myCounter.slice();g._appleText=g.game.add.bitmapText(-140-30,10,"font","0/"+g._myCounter[1].toString(),32);g._appleText.anchor.setTo(0,0.5);g.addChild(g._appleText);g._leafText=g.game.add.bitmapText(-5,10,"font","0/"+g._myCounter[3].toString(),32);g._leafText.anchor.setTo(0,0.5);g.addChild(g._leafText);g._grapeText=g.game.add.bitmapText(5+125+30,10,"font","0/"+g._myCounter[4].toString(),32);g._grapeText.anchor.setTo(0,0.5);g.addChild(g._grapeText);g._delta=new Array(g._myCounter.length);for(var f=0;f<g._delta.length;f++){g._delta[f]=0}g._timer=0;g._sleepTime=1;return g}d.prototype.scaleFruits=function(e){this._apple.scale.set(e);this._fruitScale=e;this._grapes.scale.set(e)};Object.defineProperty(d.prototype,"finishScreenCallback",{set:function(e){this._finishCallback=e},enumerable:true,configurable:true});d.prototype.replay=function(){this._finishWasFired=false;this._myCounter=[0,window.firstElement,0,window.secondElement,0,0];this._delta=new Array(this._myCounter.length);for(var e=0;e<this._delta.length;e++){this._delta[e]=0}this._appleText.text="0/"+window.firstElement.toString();this._grapeText.text="0/"+window.secondElement.toString()};d.prototype.updateCounter=function(e,f){if(window.collectable){if((e==1||e==3||e==4)&&this._myCounter[e]>0){this._delta[e]+=f;this._sleepTime=200}}};d.prototype.setLandscape=function(){this._border.angle=0;this._myMask.clear();this._trash.scale.set(1);this._trash2.scale.set(1);this._fountain.y=110;this._myMask.beginFill(16777215);this._myMask.drawRoundedRect(-500/2,-600,545,688-2,30);this._myMask.endFill();this._border.position.set(0,70-688/2);this._leaf1.position.set(-300,-200);this._leaf1.angle=0};d.prototype.setPortrait=function(){this._border.angle=90;this._trash.scale.set(1.2);this._trash2.scale.set(1.2);this._fountain.y=185;this._border.position.set(0,70-688/2+65+10);this._myMask.clear();this._myMask.beginFill(16777215);this._myMask.drawRoundedRect(-500/2-70+1,-600+57+90,688-5,545-2,30);this._myMask.endFill();this._leaf1.position.set(-230,360);this._leaf1.angle=-90};d.prototype.getElementPosition=function(e){if(e=="first"){return new Phaser.Point(this._apple.worldPosition.x,this._apple.worldPosition.y)}else{if(e=="second"){return new Phaser.Point(this._leaf.worldPosition.x,this._leaf.worldPosition.y)}else{return new Phaser.Point(this._grapes.worldPosition.x,this._grapes.worldPosition.y)}}};d.prototype.initFruits=function(){var e=this;this._apple=this.game.add.sprite(this.x-this._sprite.width/2+50,this.y+2,"atlas","F_1");this._apple.scale.setTo(0.8);this._apple.anchor.setTo(0.5);this.parent.addChild(this._apple);this._grapes=this.game.add.sprite(this.x-40+(this._sprite.width/2-90),this.y+2,"atlas","F_4");this._grapes.scale.setTo(0.8);this._grapes.anchor.setTo(0.5);this.parent.addChild(this._grapes);this._leaf=this.game.add.sprite(this.x-40,this.y+2,"atlas","F_3");this._leaf.scale.set(0.8);this._leaf.anchor.set(0.5);this.parent.addChild(this._leaf);this._appleTween=this.game.add.tween(this._apple.scale).to({x:this._fruitScale+0.2,y:this._fruitScale+0.2},150,Phaser.Easing.Linear.None,false);this._appleTween.onComplete.add(function(){e._apple.scale.set(e._fruitScale)});this._leafTween=this.game.add.tween(this._leaf.scale).to({x:this._fruitScale+0.2,y:this._fruitScale+0.2},150,Phaser.Easing.Linear.None,false);this._leafTween.onComplete.add(function(){e._leaf.scale.set(e._fruitScale)});this._grapesTween=this.game.add.tween(this._grapes.scale).to({x:this._fruitScale+0.2,y:this._fruitScale+0.2},150,Phaser.Easing.Linear.None,false);this._grapesTween.onComplete.add(function(){e._grapes.scale.set(e._fruitScale)},this)};d.prototype.unlockObject=function(){var f=this;switch(this._unclocksCounter){case 0:this.game.add.tween(this._trash2).to({alpha:0.7},1000,Phaser.Easing.Sinusoidal.InOut,true).onComplete.addOnce(function(){f.game.add.tween(f._trash).to({alpha:0},750,Phaser.Easing.Sinusoidal.InOut,true).onComplete.addOnce(function(){f._trash.visible=false},f);f.game.add.tween(f._trash2).to({alpha:0},750,Phaser.Easing.Sinusoidal.InOut,true).onComplete.addOnce(function(){f._trash2.blendMode=PIXI.blendModes.NORMAL})},this);break;case 1:this._benches.forEach(function(h,g){h.scale.multiply(1.3,1.3);h.alpha=1;f.game.add.tween(h.scale).to({x:1-2*g,y:1},1000,Phaser.Easing.Back.Out,true);f.game.add.tween(f._brightBenches[g]).to({alpha:0},1000,Phaser.Easing.Sinusoidal.InOut,true).onComplete.addOnce(function(){f._brightBenches[g].blendMode=PIXI.blendModes.NORMAL})});break;case 2:var e=this._fontains[0];e.alpha=1;e.scale.set(1.3);this._fontains[1].alpha=0.7;this.game.add.tween(e.scale).to({x:1,y:1},1000,Phaser.Easing.Back.Out,true);this.game.add.tween(this._fontains[1]).to({alpha:0},1000,Phaser.Easing.Sinusoidal.InOut,true).onComplete.addOnce(function(){f._fontains[1].blendMode=PIXI.blendModes.NORMAL},this);break}this._unclocksCounter++};d.prototype.hideText=function(e){var f=this;if(e.alpha>0){this.game.add.tween(e).to({alpha:0},500,Phaser.Easing.Sinusoidal.InOut,true).onComplete.addOnce(function(){var g=f.game.add.sprite(e.x+30,e.y-10,"atlas","Quest-Board-02");g.alpha=0;f.game.add.tween(g).to({alpha:1},200,Phaser.Easing.Sinusoidal.InOut,true);g.anchor.set(0.5);f.addChild(g)})}};d.prototype.update=function(){var e=this.game.time.elapsedMS;if(this._timer>0){this._timer-=e}if(this._delta[1]>0||this._delta[3]>0||this._delta[4]){this._timer=this._sleepTime;this._fruitsCounter++;if(this._delta[1]>0){this._delta[1]--;this._myCounter[1]--;if(this._myCounter[1]<=0){this._appleText.text=window.firstElement.toString()+"/"+window.firstElement.toString();this.hideText(this._appleText);this.unlockObject()}else{this._appleTween.start();this._appleText.text=(window.firstElement-this._myCounter[1]).toString()+"/"+window.firstElement.toString()}}if(this._delta[3]>0){this._delta[3]--;this._myCounter[3]--;if(this._myCounter[3]<=0){this._leafText.text=window.secondElement.toString()+"/"+window.secondElement.toString();this.unlockObject();this.hideText(this._leafText)}else{this._leafTween.start();this._leafText.text=(window.secondElement.toString()-this._myCounter[3]).toString()+"/"+window.secondElement.toString()}}if(this._delta[4]>0){this._delta[4]--;this._myCounter[4]--;if(this._myCounter[4]<=0){this._grapeText.text=window.thirdElement.toString()+"/"+window.thirdElement.toString();this.unlockObject();this.hideText(this._grapeText)}else{this._grapesTween.start();this._grapeText.text=(window.thirdElement.toString()-this._myCounter[4]).toString()+"/"+window.thirdElement.toString()}}}};return d}(Phaser.Sprite));a.Panel=b})(mygame||(mygame={}));var mygame;(function(b){var a=(function(){function c(){this._array=[];this._bombPosition=null}c.prototype.add=function(d,e){if(!this.contains(d,e)){this._array.push(new Phaser.Point(d,e))}};Object.defineProperty(c.prototype,"bombPosition",{get:function(){return this._bombPosition},enumerable:true,configurable:true});Object.defineProperty(c.prototype,"isBomb",{get:function(){if(this._array.length>3){var d=Math.floor(this._array.length/2);if(this._bombPosition==null){this._bombPosition=new Phaser.Point(this._array[d].x,this._array[d].y)}return true}return false},enumerable:true,configurable:true});c.prototype.setBombPosition=function(d,e){this._bombPosition=new Phaser.Point(d,e)};c.prototype.contains=function(d,g){for(var e=0;e<this._array.length;e++){var f=this._array[e];if(f.x==d&&f.y==g){return true}}return false};c.prototype.get=function(d){return this._array[d]};c.prototype.push=function(d,e){this.add(d,e)};c.prototype.merge=function(e){var d=e.length;for(var f=0;f<d;f++){this._array.push(e.pop())}};Object.defineProperty(c.prototype,"length",{get:function(){return this._array.length},enumerable:true,configurable:true});c.prototype.pop=function(){return this._array.pop()};return c}());b.Sequence=a})(mygame||(mygame={}));