var __extends=(this&&this.__extends)||(function(){var a=Object.setPrototypeOf||({__proto__:[]} instanceof Array&&function(e,c){e.__proto__=c})||function(f,c){for(var e in c){if(c.hasOwnProperty(e)){f[e]=c[e]}}};return function(f,c){a(f,c);function e(){this.constructor=f}f.prototype=c===null?Object.create(c):(e.prototype=c.prototype,new e())}})();var mygame;(function(b){var a=(function(d){__extends(c,d);function c(){return d!==null&&d.apply(this,arguments)||this}c.prototype.preload=function(){this.preloadBarBackground=this.add.image(0,0,"preloaderBarEmpty");this.preloadBar=this.add.image(0,0,"preloaderBar");this.preloadBarBackground.alignIn(this.game.world.bounds,Phaser.CENTER);this.preloadBar.x=Math.floor(this.preloadBarBackground.x);this.preloadBar.y=Math.floor(this.preloadBarBackground.y);this.load.setPreloadSprite(this.preloadBar);this.icon=this.add.image(0,0,"connect");this.icon.anchor.set(0.5);this.icon.scale.x=-1;this.icon.x=this.preloadBarBackground.x+this.preloadBarBackground.width/2;this.icon.y=this.preloadBarBackground.y+this.preloadBarBackground.height+25;var e=this.game.time.events.loop(10,function(){this.icon.rotation+=0.1},this);var f=window.baseURL;this.game.load.image("background",f+"assets/background_1.png");this.game.load.atlas("objects",f+"assets/objects.png",f+"assets/objects.json");if(window.myLang=="en"){this.game.load.image("play_free",f+"assets/EngButton.png")}else{this.game.load.image("play_free",f+"assets/DutButton.png")}this.game.load.atlasJSONHash("images",f+"assets/images.png",f+"assets/images.json");this.game.load.bitmapFont("font",f+"assets/font.png",f+"assets/font.fnt")};c.prototype.create=function(){this.game.state.start("PlayState")};c.prototype.ChangeSize=function(){this.game.scale.setGameSize(window.innerWidth,window.innerHeight);this.preloadBarBackground.width=window.innerWidth;this.preloadBarBackground.scale.x=this.preloadBarBackground.scale.x-0.1;this.preloadBarBackground.scale.y=this.preloadBarBackground.scale.x;this.preloadBar.scale.set(this.preloadBarBackground.scale.x,this.preloadBarBackground.scale.y);if(this.game.scale.width>window.innerWidth){this.game.canvas.style.marginLeft="-"+(this.game.scale.width-window.innerWidth)/2+"px"}this.preloadBarBackground.alignIn(this.game.world.bounds,Phaser.CENTER);this.preloadBar.x=this.preloadBarBackground.x;this.preloadBar.y=this.preloadBarBackground.y;this.icon.x=this.preloadBarBackground.x+this.preloadBarBackground.width/2;this.icon.y=this.preloadBarBackground.y+this.preloadBarBackground.height+30};return c}(Phaser.State));b.Preloader=a})(mygame||(mygame={}));var mygame;(function(c){var a="1.0.0";var e=(function(i){__extends(j,i);function j(){var k=i.call(this,true)||this;k._winTweens=[];return k}j.prototype.create=function(){var l=this;this.game.time.advancedTiming=true;console.log("222");this.game.stage.smoothed=true;this._canShowEndScreen=false;c.Controller.Instance.width=d().width;c.Controller.Instance.height=d().height;this._container=new c.OSprite(c.Core.centerX,0).otherXY(c.Core.centerY,0).end();this._background=new c.OSprite(c.Core.centerX,c.Core.centerY-650,"background").myScale(1.8).otherScale(0.75).otherXY(c.Core.centerY,c.Core.centerX).enabledBgMode().end();this.game.world.addChild(this._background);this._playFreeBtnOsprite=new c.OSprite(c.Core.centerX,0).myBottomOffset(70).myScale(0.65).end();this._playFreeBtnOsprite.otherXY(c.Core.centerY,0).otherBottomOffset(70).otherScale(0.65).end();this._playFree=this.game.add.sprite(0,0,"play_free");this._playFree.scale.set(1.3);this._playFree.anchor.set(0.5,0.5);this._playFree.inputEnabled=true;this._playFree.events.onInputDown.add(function(){window.trackClick()},this);this._playFreeBtnOsprite.addChild(this._playFree);if(!window.collectable){this._playFree.alpha=0;this._playFree.y=300}this.game.add.tween(this._playFree.scale).to({x:1.45,y:1.45},900,Phaser.Easing.Sinusoidal.Out,true,0,-1,true);if(window.collectable){this._gamePanelOsprite=new c.OSprite(c.Core.centerX,0).myTopOffset(160).myScale(0.9).end();this._gamePanelOsprite.otherXY(c.Core.centerY,0).otherTopOffset(230).otherScale(1.1).end();this._panel=new c.Panel(this.game,0,0);this._gamePanelOsprite.addChild(this._panel);this._panel.initFruits()}var k;if(c.Core.isLandscape){k=-400;c.GameConfig.gameArray=c.GameConfig.deepClone(c.GameConfig.gameArrayLandscape);if(c.GameConfig.gameArray.length>6){c.GameConfig.gameArray=c.GameConfig.transpose(c.GameConfig.gameArray)}}else{c.GameConfig.gameArray=c.GameConfig.deepClone(c.GameConfig.gameArrayPortret);k=-300;if(c.GameConfig.gameArray.length<8){c.GameConfig.gameArray=c.GameConfig.transpose(c.GameConfig.gameArray)}}if(window.collectable){this._container=new c.OSprite(c.Core.centerX,c.Core.centerY+30).otherXY(c.Core.centerY,c.Core.centerX-30).end();this._field=new c.Field(this.game,0,0,this);this._container.addChild(this._field);this._field.destroyCallback=function(m,n){l._panel.updateCounter(m,n)};this._field.finalCallback=this.showWinScreen.bind(this);this._container.myScale(0.95).otherScale(1.05).end()}else{this._container=new c.OSprite(c.Core.centerX,c.Core.centerY).otherXY(c.Core.centerY,c.Core.centerX-80).end();this._field=new c.Field(this.game,0,0,this);this._container.addChild(this._field);this._field.destroyCallback=function(m,n){m+1};this._field.firstMatchCallback=function(){var m=l.game.add.tween(l._playFree).to({y:0,},500,Phaser.Easing.Sinusoidal.InOut,true,window.playfreeTime);m.onStart.add(function(){l._playFree.alpha=1},l)};this._container.myScale(1).otherScale(1.15).end()}if(c.Core.isLandscape){this._field.pivot.set(100*c.GameConfig.gameArray[0].length/2,100*c.GameConfig.gameArray[1].length/5)}else{this._field.pivot.set(100*c.GameConfig.gameArray[0].length/2,100*c.GameConfig.gameArray[1].length/2)}this._finalContainer=this.game.add.sprite(0,0);this.initWinScreen();this._logoOsprite=new c.OSprite(c.Core.centerX,0).myTopOffset(10).myScale(0.65).end();this._logoOsprite.otherXY(c.Core.centerY,0).otherTopOffset(15).otherScale(0.95).end();this._logo=this.game.add.sprite(0,0,"objects","logo.png");this._logo.anchor.set(0.5,0);this._logoOsprite.addChild(this._logo)};j.prototype.readyToEndScreen=function(){this._canShowEndScreen=true};j.prototype.checkShowEndScreen=function(){if(this._canShowEndScreen){this.showWinScreen()}};j.prototype.getGurrentElementPosition=function(k){return this._panel.getElementPosition(k)};j.prototype.initWinScreen=function(){var k=this;this._winScreen=new c.OSprite(c.Core.centerX,20).otherXY(c.Core.centerY,20).end();this._finalContainer.addChild(this._winScreen);this._winBG=this.game.add.sprite(0,-40,"objects","bg_final.png");this._winBG.anchor.set(0.5,0);this._winScreen.addChild(this._winBG);this._ostinClap=new c.OSprite(0,0).myBottomOffset(480).myLeftOffset(25).otherBottomOffset(530).otherLeftOffset(25).myScale(2.25).otherScale(2.65).otherXY(20,700).end();this._ostinClapSprite=this.game.add.sprite(0,0,"objects","ostin_clap_1.png");this._ostinClap.addChild(this._ostinClapSprite);this._ostinClapSprite.animations.add("clap",["ostin_clap_1.png","ostin_clap_2.png"],6,true);this._finalContainer.addChild(this._ostinClap);this._winBG.scale.set(6);this._sunray=this.game.add.sprite(0,300-20,"objects","stars_bg.png");this._sunray.anchor.set(0.5,0.5);this._sunray.y+=this._sunray.height/2;this._winScreen.addChild(this._sunray);this._backStars=this.game.add.sprite(0,500,"objects","back_stars.png");this._backStars.anchor.set(0.5,0.5);this._winScreen.addChild(this._backStars);this._star=this.game.add.sprite(-10,500,"objects","final_star.png");this._star.anchor.set(0.5,0.5);this._winScreen.addChild(this._star);this._welldone=this.game.add.sprite(0,180,"objects","well_done_final.png");this._welldone.anchor.set(0.5,0);this._winScreen.addChild(this._welldone);this._installNowSpriteOriginal=this.game.add.sprite(0,0,"objects","install_final.png");this._installNowSpriteOriginal.anchor.set(0.5,0.5);this._installNowSprite=new c.OSprite(1100-20,520).otherXY(600-50,1035).myScale(1.5).otherScale(1.25).end();this._finalContainer.addChild(this._installNowSprite);this._installNowSprite.events.onInputDown.add(function(){window.trackClick()},this);this._installNowSprite.addChild(this._installNowSpriteOriginal);this._replaySprite=new c.OSprite(1100-20,650,"objects","replay_final.png").otherXY(600-50,1150).myScale(1.35).otherScale(1.2).end();this._replaySprite.events.onInputDown.add(function(){k._field.replay();if(window.collectable){k._panel.replay()}k.hideWinScreen()},this);this._finalContainer.addChild(this._replaySprite);if(c.Core.isLandscape){this._welldone.scale.set(1.25);this._sunray.scale.set(1.2)}else{this._welldone.scale.set(1.5);this._sunray.scale.set(1.3)}this._finalContainer.x=-1800;if(this._winScreen.children.indexOf(this._logo)>0){}this._installNowSpriteOriginal.scale.set(0.85,0.85);this._installNowSpriteOriginal.angle=3;this._installNowSprite.alpha=0;this._replaySprite.alpha=0;this._container.alpha=1;this._ostinClap.alpha=0;this._winScreen.alpha=0;this._installNowSprite.inputEnabled=false;this._replaySprite.inputEnabled=false;this._canShowEndScreen=false};j.prototype.hideWinScreen=function(){var k=this;if(this._winScreen.children.indexOf(this._logo)>0){}this._logoOsprite.otherScale(0.95).end();this.game.add.tween(this._logo.scale).to({x:1,y:1},500,Phaser.Easing.Sinusoidal.Out,true);this._installNowSprite.inputEnabled=false;this._replaySprite.inputEnabled=false;this._canShowEndScreen=false;this.game.add.tween(this._finalContainer).to({x:-1800},500,Phaser.Easing.Sinusoidal.InOut,true).onComplete.addOnce(function(){k._installNowSprite.alpha=0;k._replaySprite.alpha=0;k._container.alpha=1;k._ostinClap.alpha=0;k._winScreen.alpha=0;k._installNowSpriteOriginal.scale.set(0.85,0.85);k._installNowSpriteOriginal.angle=3;for(var l=0;l<k._winTweens.length;l++){k.game.tweens.remove(k._winTweens[l])}k._winTweens=[]})};j.prototype.render=function(){};j.prototype.update=function(){if(window.collectable){this._panel.update()}};j.prototype.showWinScreen=function(){var k=this;this.game.add.tween(this._finalContainer).to({x:0},500,Phaser.Easing.Sinusoidal.InOut,true);this._ostinClapSprite.play("clap");this._field.disableField=true;this._sunray.angle=0;this._star.angle=0;this._installNowSpriteOriginal.angle=3;this._backStars.scale.set(1,1);this._installNowSpriteOriginal.scale.set(0.85,0.85);this._winScreen.alpha=1;this._ostinClap.alpha=1;this._installNowSprite.alpha=1;this._replaySprite.alpha=1;this._installNowSprite.inputEnabled=true;this._replaySprite.inputEnabled=true;this._winTweens.push(this.game.add.tween(this._sunray).to({angle:360},18500,Phaser.Easing.Linear.None,true,0,-1));this._winTweens[0].onComplete.addOnce(function(){k._sunray.angle=0});this._winTweens.push(this.game.add.tween(this._backStars.scale).to({x:this._backStars.scale.x+0.25,y:this._backStars.scale.y+0.25},2800,Phaser.Easing.Sinusoidal.InOut,true,0,-1));this._winTweens[1].yoyo(true);this._winTweens.push(this.game.add.tween(this._star).to({angle:15},3400,Phaser.Easing.Sinusoidal.Out,true,0,-1));this._winTweens[2].yoyo(true);this._winTweens.push(this.game.add.tween(this._installNowSpriteOriginal.scale).to({x:1,y:1},3400,Phaser.Easing.Sinusoidal.Out,true,0,-1));this._winTweens[3].yoyo(true,3600);this._winTweens.push(this.game.add.tween(this._installNowSpriteOriginal).to({angle:-3},1200,Phaser.Easing.Sinusoidal.Out,true,0,-1));this._winTweens[4].yoyo(true,0);this.game.add.tween(this._logo.scale).to({x:1.6,y:1.6},600,Phaser.Easing.Sinusoidal.Out,true);this._logoOsprite.otherScale(0.65).end()};j.prototype.onLandscape=function(){var l=this;if(this._welldone){this._welldone.scale.set(1.25);this._sunray.scale.set(1.2)}if(this._playFree&&this.game.device.iPad){}if(this._field&&c.GameConfig.gameArray.length!=4){c.GameConfig.gameArray=c.GameConfig.deepClone(c.GameConfig.gameArrayLandscape);var k=this._field.y;this._field.destroy();this._field=new c.Field(this.game,0,0,this);this._field.pivot.set(100*c.GameConfig.gameArray[0].length/2,100*c.GameConfig.gameArray[1].length/5);this._container.addChild(this._field);if(window.collectable){this._field.destroyCallback=function(m,n){l._panel.updateCounter(m,n)};this._field.finalCallback=this.showWinScreen.bind(this)}else{this._field.destroyCallback=function(m,n){m+1}}}};j.prototype.onPortret=function(){var l=this;if(this._welldone){this._welldone.scale.set(1.5);this._sunray.scale.set(1.3)}if(this._playFree&&this.game.device.iPad){}if(this._field&&c.GameConfig.gameArray.length!=8){c.GameConfig.gameArray=c.GameConfig.deepClone(c.GameConfig.gameArrayPortret);var k=this._field.y;this._field.destroy();this._field=new c.Field(this.game,0,0,this);this._field.pivot.set(100*c.GameConfig.gameArray[0].length/2,100*c.GameConfig.gameArray[1].length/2);this._container.addChild(this._field);if(window.collectable){this._field.destroyCallback=function(m,n){l._panel.updateCounter(m,n)};this._field.finalCallback=this.showWinScreen.bind(this)}else{this._field.destroyCallback=function(m,n){m+1}}}};j.prototype.ChangeSize=function(){};return j}(c.OState));c.PlayState=e;function d(m){if(m===void 0){m=false}var j=0;var l=0;var i=0;var k=0;if(!(document.documentElement.clientWidth==0)){i=document.documentElement.clientWidth;k=document.documentElement.clientHeight}j=i;l=k;if(window.innerWidth>window.innerHeight){j=window.innerWidth;l=window.innerHeight}return{width:j,height:l}}function h(i,j){if(j===void 0){j=null}window.trackEvent(i,j)}function f(){}function g(){}function b(){window.trackClick()}})(mygame||(mygame={}));var mygame;(function(a){var b=(function(){function c(){this.balance=500;this.dealTime=5;this.playerMoney=3000;this.soundsEnabled=true;this.width=1280;this.height=720;this.orientation=c.LANDSCAPE}Object.defineProperty(c,"Instance",{get:function(){if(this.instance===null||this.instance===undefined){this.instance=new c()}return this.instance},enumerable:true,configurable:true});c.prototype.playSound=function(d){if(this.soundsEnabled){}};return c}());b.LANDSCAPE="landscape";b.PORTRAIT="portrait";a.Controller=b})(mygame||(mygame={}));var mygame;(function(b){var a=(function(d){__extends(c,d);function c(){return d!==null&&d.apply(this,arguments)||this}c.prototype.preload=function(){this.load.crossOrigin="anonymous";var e=window.baseURL;this.game.load.image("connect",e+"assets/connect.png");this.game.load.image("preloaderBar",e+"assets/loadingBarOnly.png");this.game.load.image("preloaderBarEmpty",e+"assets/loadingBarEmpty.png")};c.prototype.create=function(){b.Controller.Instance.orientation=b.Controller.LANDSCAPE;if(window.orientation=="p"){b.Controller.Instance.orientation=b.Controller.PORTRAIT}this.game.input.touch.preventDefault=false;this.game.stage.backgroundColor=1907997;this.input.maxPointers=1;this.stage.disableVisibilityChange=true;b.Core.begin(this.game,!this.game.device.desktop);this.game.state.start("Preloader")};c.prototype.ChangeSize=function(){};return c}(Phaser.State));b.Boot=a})(mygame||(mygame={}));var mygame;(function(a){var b=(function(c){__extends(d,c);function d(){var e=c.call(this,1280,720,Phaser.AUTO,"mdsp-creative",null,false,true)||this;a.Core.init(1280,720);e.state.add("Boot",a.Boot,false);e.state.add("Preloader",a.Preloader,false);e.state.add("PlayState",a.PlayState,false);e.state.start("Boot");return e}return d}(Phaser.Game));a.Game=b})(mygame||(mygame={}));var mygame;(function(c){var a;(function(d){d[d.DISABLED=0]="DISABLED";d[d.ACTIVE=1]="ACTIVE"})(a=c.BlockTypes||(c.BlockTypes={}));var b=(function(e){__extends(d,e);function d(g,f,l,j){var k=e.call(this,g,f,l)||this;k._fieldUpperBound=[];k._playState=j;k._destroyed=0;k._turnOffMask=false;k._firstMatch=false;k._finalWasFired=false;k._gameArray=c.GameConfig.gameArray;k._fieldUpperBound=[0,0,0,0,0,0,0,0,0,0,0];k._streak=[];for(var h=0;h<6;h++){k._streak.push(0)}k._disabled=false;k._bgContainer=k.game.add.sprite(0,0);k._bgContainer.anchor.set(0.5,0);k.addChild(k._bgContainer);k._container=k.game.add.sprite(0,0);k._container.anchor.set(0.5,0);k.addChild(k._container);k._myMask=k.game.add.graphics(0,0);k.addChild(k._myMask);k._container.mask=k._myMask;k._myMask.beginFill(16777215);k._myMask.drawRect(0,0,100*10,100*8);k._myMask.endFill();k.drawField();k._selectedGem=null;if(window.collectable){k._counters=c.GameConfig.COUNTERS_PUBLIC}else{k._counters=[-1,-1,-1,-1,-1,-1,-1]}k.game.input.onUp.add(function(){try{k.game.input.deleteMoveCallback(k.gemMove,k)}catch(i){console.log("error")}},k);k._canClick=true;return k}Object.defineProperty(d.prototype,"firstMatchCallback",{set:function(f){this._firstMatchCallback=f},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"endMatchCallback",{set:function(f){this._endMatchCallback=f},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"disableField",{set:function(f){this._disabled=f},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"destroyCallback",{set:function(f){this._cb=f},enumerable:true,configurable:true});d.prototype.mydebug=function(){};Object.defineProperty(d.prototype,"finalCallback",{set:function(f){this._finalCallback=f},enumerable:true,configurable:true});d.prototype.gemMove=function(k,j,i){var g=j-this._selectedPoint.x;var f=i-this._selectedPoint.y;var h=0;var l=0;if(Math.abs(g)>c.GameConfig.BLOCK_SIZE/2){if(g>0){l=1}else{l=-1}}else{if(Math.abs(f)>c.GameConfig.BLOCK_SIZE/2){if(f>0){h=1}else{h=-1}}}if(h+l!=0){this._pickedGem=this._gameArray[this._selectedGem.row+h][this._selectedGem.col+l];if(this._pickedGem.mytype>0){this._selectedGem.deselect();this.swapGems(true);this.game.input.deleteMoveCallback(this.gemMove,this)}else{this._pickedGem=null}}};d.prototype.drawField=function(){var l=this;for(var h=0;h<this._gameArray.length;h++){var f=function(n){var q=k._gameArray[h][n];var i=c.GameConfig.BLOCK_SIZE*(n+0.5);var r=c.GameConfig.BLOCK_SIZE*(h+0.5);if(q>0){var o=new c.Gem(k.game,i,r,q);var p=k.game.add.sprite(i,r,"objects","tile.png");p.anchor.set(0.5);k._bgContainer.addChild(p);k._container.addChild(o);o.inputEnabled=true;o.row=h;o.col=n;o.events.onInputDown.add(function(s,t){var j;if(l._gameArray.length==8){j=window.tutorial&&(o.row==1)&&(o.mytype==1)||!window.tutorial}else{j=window.tutorial&&(o.row==0)&&(o.mytype==1)||!window.tutorial}if(l._canClick&&j&&!l._disabled){if(l._selectedGem==null){l._selectedGem=o;l._selectedPoint=new Phaser.Point(t.x,t.y);o.select();l.game.input.addMoveCallback(l.gemMove,l)}else{l.gemSelect(o)}}},k);if(k._gameArray.length==8){if(!((h==1||h==2)&&o.mytype==1)&&window.tutorial){o.alpha=0.2}}else{if(!((h==1||h==0)&&o.mytype==1)&&window.tutorial){o.alpha=0.2}}k._gameArray[h][n]=o}else{var m=k.game.add.sprite(i,r,"grass");m.width=m.height=c.GameConfig.BLOCK_SIZE;m.anchor.set(0.5);k.addChild(m);k._gameArray[h][n]=new c.Gem(k.game,i,r,0);k._gameArray[h][n].row=h;k._gameArray[h][n].col=n}};var k=this;for(var g=0;g<this._gameArray[h].length;g++){f(g)}}if(window.tutorial){console.log("henlo");this._hand=this.game.add.sprite(100*4-20,100*2-20,"objects","hand.png");this._hand.anchor.set(0.5);if(this._gameArray.length==8){this._handTween=this.game.add.tween(this._hand).to({y:280},500,Phaser.Easing.Linear.None,true,0,-1,true)}else{this._handTween=this.game.add.tween(this._hand).to({y:80},500,Phaser.Easing.Linear.None,true,0,-1,true)}this.addChild(this._hand)}};d.prototype.replay=function(){this._disabled=false;this._finalWasFired=false;if(window.collectable){this._counters=c.GameConfig.COUNTERS.slice()}else{this._counters=[-1,-1,-1,-1,-1,-1,-1]}};d.prototype.gemSelect=function(f){if(this._selectedGem==null){console.log("something strange");return}if(this._selectedGem.isSame(f)){this._selectedGem.deselect();this._selectedGem=null;return}if(this._selectedGem.isNext(f)){this._selectedGem.deselect();this._pickedGem=f;this.swapGems();console.log("swap!")}else{this._selectedGem.deselect();this._selectedGem=f;f.select()}};d.prototype.swapGems=function(s){var r=this;if(s===void 0){s=true}if(window.tutorial){if(this._pickedGem.row-this._selectedGem.row!=1){return}else{window.tutorial=false;for(var o=0;o<this._gameArray.length;o++){for(var m=0;m<this._gameArray[o].length;m++){this._gameArray[o][m].alpha=1;this._handTween.stop();this._hand.destroy()}}}}this._canClick=false;this._coolAnimation=true;this._verticalAnimation=false;this._gameArray[this._selectedGem.row][this._selectedGem.col]=this._pickedGem;this._gameArray[this._pickedGem.row][this._pickedGem.col]=this._selectedGem;var q=this._selectedGem.row;var t=this._selectedGem.col;var u=this._pickedGem.row;var h=this._pickedGem.col;this._selectedGem.row=u;this._selectedGem.col=h;this._pickedGem.row=q;this._pickedGem.col=t;var k=new Phaser.Point((h+0.5)*c.GameConfig.BLOCK_SIZE,(u+0.5)*c.GameConfig.BLOCK_SIZE);var g=new Phaser.Point((t+0.5)*c.GameConfig.BLOCK_SIZE,(q+0.5)*c.GameConfig.BLOCK_SIZE);var p=this.game.add.tween(this._selectedGem).to({x:k.x,y:k.y},c.GameConfig.SWAP_TIME,Phaser.Easing.Linear.None,false);var f=this.game.add.tween(this._pickedGem).to({x:g.x,y:g.y},c.GameConfig.SWAP_TIME,Phaser.Easing.Linear.None,false);var n=this._selectedGem.mytype;var l=this._pickedGem.mytype;f.onComplete.add(function(){if(r.isMatchOnBoard(u,h,n,q,t,l)){console.log("DESTROY!!!");r.handleMatches();r._selectedGem=null;r._pickedGem=null}else{if(s){r.swapGems(false)}}},this);f.start();p.start();if(!s){this._selectedGem.deselect();this._selectedGem=null;this._pickedGem=null;this._canClick=true}};d.prototype.isMatchOnBoard=function(j,k,f,g,i,h){return this.isMatch(j,k,f)||this.isMatch(g,i,h)};d.prototype.isMatch=function(h,f,g){return this.isHorizontal(h,f,g)||this.isVertical(h,f,g)};d.prototype.isHorizontal=function(n,k,m){var o;var g;var f=0;for(var l=0;l<3;l++){f=0;o=k+l;g=o-2;if(o>=this._gameArray[0].length){continue}if(g<0){continue}for(var h=o;h>=g;h--){if(this._gameArray[n][h].mytype==m){f++}}if(f>2){return true}}return false};d.prototype.isVertical=function(n,k,m){var o;var g;var f=0;for(var h=0;h<3;h++){f=0;o=n+h;g=o-2;if(o>=this._gameArray.length){continue}if(g<0){continue}for(var l=o;l>=g;l--){if(this._gameArray[l][k].mytype==m){f++}}if(f>2){return true}}return false};d.prototype.debugShow=function(){for(var g=0;g<this._gameArray.length;g++){var h="";for(var f=0;f<this._gameArray[g].length;f++){if(this._gameArray[g][f]!==-1){h+=this._gameArray[g][f].mytype+" "}else{h+=" -1 "}}console.log(h)}};d.prototype.handleMatches=function(){if(!this._firstMatch&&!window.collectable){this._firstMatch=true;this._firstMatchCallback()}this._removeMap=[];for(var g=0;g<this._gameArray.length;g++){this._removeMap[g]=[];for(var f=0;f<this._gameArray[g].length;f++){this._removeMap[g].push(0)}}this.handleHorizontalMatches();this.handleVerticalMatches();this.destroyGems();this._coolAnimation=false};d.prototype.destroyGems=function(){var m=this;if(this._destroyed>0){}this._destroyed=0;var o;var h;if(this._selectedGem!=null){if(this._removeMap[this._selectedGem.row][this._selectedGem.col]>0){o=new Phaser.Point(this._selectedGem.x,this._selectedGem.y);h=this._selectedGem.mytype}else{if(this._removeMap[this._pickedGem.row][this._pickedGem.col]>0){o=new Phaser.Point(this._pickedGem.x,this._pickedGem.y);h=this._pickedGem.mytype}else{o=new Phaser.Point(1,1);h=0;console.log("something went wrong")}}}this._coolAnimation=false;if(this._coolAnimation){console.log("create cool animation");this.condensate(o)}else{console.log("create cool animation");var p=[];var n=[];var l=0;for(var k=0;k<this._removeMap.length;k++){var f=function(r){if(q._removeMap[k][r]>0){q._destroyed++;var u=q._gameArray[k][r];if((u.mytype==1||u.mytype==2)&&q._counters[u.mytype]>0){var i=void 0;if(u.mytype==1){i=q._playState.getGurrentElementPosition("first")}else{i=q._playState.getGurrentElementPosition("second")}var v=u.worldPosition.x;var t=u.worldPosition.y;q._container.removeChild(u);q.game.world.addChild(u);u.position.set(v,t);var s=q.createFlyTween(u,i,l);l+=100;n.push(s)}else{u.onDestroy=function(){m._destroyed--;m._counters[u.mytype]-=1;m._cb(u.mytype,1);if(m._destroyed==0){m.makeGemsFall()}};p.push(u)}}};var q=this;for(var g=0;g<this._removeMap[k].length;g++){f(g)}}p.forEach(function(i){return i.playDestroy()});n.forEach(function(i){return i.start()})}};d.prototype.handleHorizontalMatches=function(){for(var m=0;m<this._gameArray.length;m++){var n=1;var f=-100500;var h=0;for(var l=0;l<this._gameArray[m].length;l++){if(this._gameArray[m][l].mytype==f&&this._gameArray[m][l].mytype>0){n++}if(this._gameArray[m][l].mytype!=f||l==this._gameArray[m].length-1){if(n>=3){console.log("HORIZONTAL :: Length = "+n+" :: Start = ("+m+","+h+") :: Color = "+f);if(this._counters[f]<=0||!this._coolAnimation){this._coolAnimation=false}for(var g=0;g<n;g++){this._removeMap[m][h+g]++}}h=l;n=1;f=this._gameArray[m][l].mytype}}}};d.prototype.handleVerticalMatches=function(){for(var m=0;m<this._gameArray[0].length;m++){var o=1;var f=-100500;var h=0;for(var l=0;l<this._gameArray.length;l++){try{if(this._gameArray[l][m].mytype==f&&this._gameArray[l][m].mytype>0){o++}}catch(n){}if(this._gameArray[l][m].mytype!=f||l==this._gameArray.length-1){if(o>=3){console.log("VERTICAL :: Length = "+o+" :: Start = ("+h+","+m+") :: Color = "+f);if(this._counters[f]<=0||!this._coolAnimation){this._coolAnimation=false}else{this._verticalAnimation=true}for(var g=0;g<o;g++){this._removeMap[h+g][m]++}}h=l;o=1;f=this._gameArray[l][m].mytype}}}};d.prototype.checkGlobalMatch=function(){for(var g=0;g<this._gameArray.length;g++){for(var f=0;f<this._gameArray[g].length;f++){if(this._gameArray[g][f].mytype<=0){continue}if(this.isMatch(g,f,this._gameArray[g][f].mytype)){return true}}}return false};d.prototype.swap=function(i,k,h,j,g){if(g===void 0){g=0}var f=this._gameArray[i][k];f.row=h-g;f.col=j;this._gameArray[i][k]=this._gameArray[h][j];this._gameArray[i][k].row=i-g;this._gameArray[i][k].col=k;this._gameArray[h][j]=f};d.prototype.makeGemsFall=function(){var s=this;if(this._destroyed>0){this.game.time.events.add(200,this.makeGemsFall,this)}if(this._turnOffMask){this._turnOffMask=false;this._container.mask=this._myMask}var o=this.findHoles();var t=[];var l=0;for(var n=0;n<o.length;n++){var f=o[n];var u=void 0;var h=void 0;var m=void 0;if(f.hasHoleAbove){u=o[n+1];h=u.row+u.length-f.length;m=f.row-h}else{h=0;m=f.row-this._fieldUpperBound[f.col]}for(var p=0;p<m;p++){this.swap(f.row-1-p,f.col,f.row+f.length-1-p,f.col)}if(!f.hasHoleAbove){for(var p=this._fieldUpperBound[f.col];p<this._fieldUpperBound[f.col]+f.length;p++){var q=this._gameArray[p][f.col];var j=this.game.rnd.between(1,5);q.mytype=j;q.x=(f.col+0.5)*c.GameConfig.BLOCK_SIZE;q.y=(q.row-f.length+0.5)*c.GameConfig.BLOCK_SIZE}h=this._fieldUpperBound[f.col];m=f.row+f.length}else{var r=f.row-(u.row+u.length-f.length);h=f.row+f.length-r;m=f.row+f.length}var g=function(w){try{v._gameArray[w][f.col]}catch(x){}var y=v._gameArray[w][f.col];l++;var k=v.game.add.tween(y).to({y:y.y+f.length*c.GameConfig.BLOCK_SIZE},c.GameConfig.FALLDOWN_TIME,Phaser.Easing.Back.Out,false);k.onComplete.add(function(){s._gameArray[y.row][y.col]=y;l--;if(l==0){if(s.checkGlobalMatch()){s.handleMatches()}else{s._canClick=true;s._selectedGem=null;if(!s._finalWasFired){var i=0;for(var B=0;B<s._counters.length;B++){if(s._counters[B]<=0){i++}if(i==s._counters.length){s._finalWasFired=true;c.GameConfig.COUNTERS_PUBLIC=c.GameConfig.COUNTERS.slice();if(s._finalCallback){s._finalCallback()}}}}for(var A=0;A<s._gameArray.length;A++){var C="";for(var z=0;z<s._gameArray[A].length;z++){C+=s._gameArray[A][z].mytype+"\t"}console.log(C)}}}});t.push(k)};var v=this;for(var p=h;p<m;p++){g(p)}}t.forEach(function(i){return i.start()})};d.prototype.createFlyTween=function(k,h,f){var j=this;var i=this.game.add.tween(k.scale).to({x:c.GameConfig.PANEL_GEM_SCALE,y:c.GameConfig.PANEL_GEM_SCALE},c.GameConfig.FLY_TIME,Phaser.Easing.Sinusoidal.InOut,false);i.onComplete.addOnce(function(){k.scale.setTo(1)},this);var g=this.game.add.tween(k).to({x:h.x,y:h.y},c.GameConfig.FLY_TIME,Phaser.Easing.Linear.None,false,f);g.onStart.addOnce(function(){i.start()});g.onComplete.add(function(m,l){j.game.world.removeChild(k);j._container.addChild(k);k.position.set(-1500,-1500);j._destroyed--;j._cb(k.mytype,1);j._counters[k.mytype]--;if(j._destroyed==0){j.makeGemsFall()}},this);return g};Object.defineProperty(d.prototype,"gameArray",{get:function(){var f=[];for(var h=0;h<this._gameArray.length;h++){f.push([]);for(var g=0;g<this._gameArray[h].length;g++){f[h][g]=this._gameArray[h][g].mytype}}return f},enumerable:true,configurable:true});d.prototype.generateFlyAwayTween=function(k,i,g,f){this._container.removeChild(k);this.addChild(k);var j=this.createFlyTween(k,g,f);if(this._verticalAnimation){return j}else{var h=this.game.add.tween(k).to({x:i.x},c.GameConfig.CONDENSATION_TIME,Phaser.Easing.Linear.None,false);h.onComplete.add(function(m,l){j.start()});return h}};d.prototype.condensate=function(f){var m=[];var h=0;for(var k=0;k<this._removeMap.length;k++){for(var g=0;g<this._removeMap[k].length;g++){if(this._removeMap[k][g]>0){this._destroyed++;var n=this._gameArray[k][g];var l=void 0;if(n.mytype==2){l=this._playState.getGurrentElementPosition("second")}else{l=this._playState.getGurrentElementPosition("first")}m.push(this.generateFlyAwayTween(n,f,l,h));m[m.length-1].onStart.addOnce(function(){});h+=100}}}m.forEach(function(i){i.start()})};d.prototype.findHoles=function(){var q=[];for(var l=0;l<this._gameArray[0].length;l++){for(var m=this._gameArray.length-1;m>=0;m--){if(this._removeMap[m][l]>0){var g=1;var n=m;var o=true;var p=false;for(var h=m-1;h>=0;h--){if(this._removeMap[h][l]>0){g++;n=h;o=true;p=false}else{if(o){q.push({row:n,col:l,length:g,hasHoleAbove:false});o=false;p=true;var f=q.length-2;if(f>=0&&q[f].col==q[f+1].col){q[f].hasHoleAbove=true}}}}if(!p){q.push({row:n,col:l,length:g,hasHoleAbove:false});var f=q.length-2;if(f>=0&&q[f].col==q[f+1].col){q[f].hasHoleAbove=true}}break}}}return q};d.prototype.destroy=function(){this.game.input.onUp.removeAll();e.prototype.destroy.call(this)};return d}(Phaser.Sprite));c.Field=b})(mygame||(mygame={}));var mygame;(function(a){var b=(function(){function c(){}c.deepClone=function(e){var d=[];for(var g=0;g<e.length;g++){d.push([]);for(var f=0;f<e[0].length;f++){d[g].push(e[g][f])}}return d};c.transpose=function(e){var d=[];for(var g=0;g<e[0].length;g++){d.push([]);for(var f=0;f<e.length;f++){d[g].push(e[f][g])}}return d};return c}());b.BLOCK_SIZE=100;b.SWAP_TIME=150;b.DESTROY_TIME=150;b.FALLDOWN_TIME=400;b.FLY_TIME=300;b.CONDENSATION_TIME=300;b.COUNTERS=[0,2,1,0,0,0];b.COUNTERS_PUBLIC=[0,2,1,0,0,0];b.NAMES=["apple","apple","grapes","flower","pear","leaf"];b.PANEL_GEM_SCALE=0.8;b.APPLE_POS=new Phaser.Point(100,-60);b.GRAPES_POS=new Phaser.Point(370,-60);b.UNLOCK_OBJ_PER_FRUITS=3;b.gameArrayLandscape=[[2,3,4,1,3,2,2,3,4,4],[3,5,1,4,1,3,1,2,3,5],[2,5,1,3,1,1,2,3,4,4],[1,3,2,4,1,3,2,4,1,3]];b.gameArrayPortret=[[1,2,5,3,4,2],[3,4,3,1,3,5],[3,5,1,5,1,1],[5,3,2,2,5,5],[2,2,4,1,2,1],[4,3,3,1,5,2],[4,1,2,3,2,5],[5,5,2,4,1,1]];a.GameConfig=b})(mygame||(mygame={}));var mygame;(function(a){var b=(function(d){__extends(c,d);function c(f,e,i,g){var h=d.call(this,f,e,i)||this;h._mytype=g;h._spriteName=a.GameConfig.NAMES[h._mytype];if(g>0){h._sprite=h.game.add.sprite(0,0,"objects","F_"+h._mytype+".png");h._sprite.anchor.set(0.5);h.addChild(h._sprite);h._destroyAnimation=h._sprite.animations.add("set off",Phaser.Animation.generateFrameNames("e_",1,7,".png"),18,false);h._destroyAnimation.onComplete.add(function(){if(!h._onCompleteFired){h._onCompleteFired=true;h._sprite.alpha=0;if(h._destroyCallback){h._destroyCallback()}}},h)}return h}Object.defineProperty(c.prototype,"row",{get:function(){return this._row},set:function(e){this._row=e},enumerable:true,configurable:true});Object.defineProperty(c.prototype,"col",{get:function(){return this._col},set:function(e){this._col=e},enumerable:true,configurable:true});Object.defineProperty(c.prototype,"mytype",{get:function(){return this._mytype},set:function(e){if(!this._onCompleteFired){this._destroyAnimation.stop();this._onCompleteFired=true;console.log("TRIGGERED!!!")}this._destroyAnimation.stop();this._mytype=e;this._spriteName=a.GameConfig.NAMES[this._mytype];this._sprite.loadTexture("objects","F_"+this._mytype+".png");this._sprite.alpha=1;this._onCompleteFired=false},enumerable:true,configurable:true});Object.defineProperty(c.prototype,"onDestroy",{set:function(e){this._destroyCallback=e},enumerable:true,configurable:true});c.prototype.playDestroy=function(){var e=this;this.game.add.tween(this._sprite.scale).to({x:0.15,y:0.15},100,Phaser.Easing.Sinusoidal.Out,true).onComplete.addOnce(function(){e._sprite.scale.set(1);e._destroyAnimation.play()})};c.prototype.select=function(){this._sprite.scale.set(1.2)};c.prototype.deselect=function(){this._sprite.scale.set(1)};c.prototype.isSame=function(e){return(this._row==e.row)&&(this._col==e.col)};c.prototype.isNext=function(e){return Math.abs(this.row-e.row)+Math.abs(this.col-e.col)==1};c.prototype.update=function(){console.log("it works")};return c}(Phaser.Sprite));a.Gem=b})(mygame||(mygame={}));var mygame;(function(a){var b=(function(c){__extends(d,c);function d(f,e,j){var h=c.call(this,f,e,j)||this;h._sprite=h.game.add.sprite(0,0,"objects","panel.png");h._sprite.anchor.set(0.5);h.addChild(h._sprite);h._fruitsCounter=0;h._finishWasFired=false;h._fruitScale=0.8;h._counters=a.GameConfig.COUNTERS.slice();h._appleText=h.game.add.bitmapText(-140,5,"font",h._counters[1].toString(),32);h._appleText.anchor.setTo(0,0.5);h.addChild(h._appleText);h._grapeText=h.game.add.bitmapText(140,5,"font",h._counters[2].toString(),32);h._grapeText.anchor.setTo(0,0.5);h.addChild(h._grapeText);h._delta=new Array(h._counters.length);for(var g=0;g<h._delta.length;g++){h._delta[g]=0}h._timer=0;h._sleepTime=1;return h}d.prototype.scaleFruits=function(e){this._apple.scale.set(e);this._fruitScale=e;this._grapes.scale.set(e)};Object.defineProperty(d.prototype,"finishScreenCallback",{set:function(e){this._finishCallback=e},enumerable:true,configurable:true});d.prototype.replay=function(){this._finishWasFired=false;this._counters=a.GameConfig.COUNTERS.slice();this._delta=new Array(this._counters.length);for(var e=0;e<this._delta.length;e++){this._delta[e]=0}this._appleText.text=this._counters[1].toString();this._grapeText.text=this._counters[2].toString()};d.prototype.updateCounter=function(e,f){if(window.collectable){if((e==1||e==2)&&this._counters[e]>0){console.log("UPDATE COUNTER = "+e+" : "+f);this._delta[e]+=f;this._sleepTime=200}}};d.prototype.getElementPosition=function(e){if(e=="first"){console.log(this._apple.worldPosition.x,this._apple.worldPosition.y);return new Phaser.Point(this._apple.worldPosition.x,this._apple.worldPosition.y)}else{console.log(this._grapes.worldPosition.x,this._grapes.worldPosition.y);return new Phaser.Point(this._grapes.worldPosition.x,this._grapes.worldPosition.y)}};d.prototype.initFruits=function(){var e=this;this._apple=this.game.add.sprite(this.x-this._sprite.width/2+45*2.35,this.y-2,"objects","F_1.png");this._apple.scale.setTo(0.8);this._apple.anchor.setTo(0.5);this.parent.addChild(this._apple);this._grapes=this.game.add.sprite(this.x+80,this.y-2,"objects","F_2.png");this._grapes.scale.setTo(0.8);this._grapes.anchor.setTo(0.5);this.parent.addChild(this._grapes);this._appleTween=this.game.add.tween(this._apple.scale).to({x:this._fruitScale+0.2,y:this._fruitScale+0.2},150,Phaser.Easing.Linear.None,false);this._appleTween.onComplete.add(function(){e._apple.scale.set(e._fruitScale)});this._grapesTween=this.game.add.tween(this._grapes.scale).to({x:this._fruitScale+0.2,y:this._fruitScale+0.2},150,Phaser.Easing.Linear.None,false);this._grapesTween.onComplete.add(function(){e._grapes.scale.set(e._fruitScale)},this)};d.prototype.checkFruitCounter=function(){};d.prototype.update=function(){var e=this.game.time.elapsedMS;if(this._timer>0){this._timer-=e}if((this._delta[1]>0||this._delta[2]>0)){this._timer=this._sleepTime;this._fruitsCounter++;if(this._delta[1]>0){this._delta[1]--;this._counters[1]--;if(this._counters[1]<=0){this._appleText.text="finish"}else{this._appleTween.start();this._appleText.text=this._counters[1].toString()}}if(this._delta[2]>0){this._delta[2]--;this._counters[2]--;if(this._counters[2]<=0){this._grapeText.text="finish"}else{this._grapesTween.start();this._grapeText.text=this._counters[2].toString()}}}};return d}(Phaser.Sprite));a.Panel=b})(mygame||(mygame={}));var Controller=mygame.Controller;var BackGround=(function(a){__extends(b,a);function b(c){var d=a.call(this,c)||this;d.bg=d.game.add.image(0,0,"background");d.addChild(d.bg);if(Controller.Instance.orientation==Controller.LANDSCAPE){d.bg.height=Controller.Instance.width;d.bg.scale.x=d.bg.scale.y;d.x=0}else{d.bg.height=Controller.Instance.height;d.bg.scale.x=d.bg.scale.y;d.x=(Controller.Instance.width-d.bg.width)/2}return d}return b}(Phaser.Group));